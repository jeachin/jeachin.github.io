<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>小C的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="小C的博客">
<meta property="og:url" content="https://mrxccc.github.io/page/2/index.html">
<meta property="og:site_name" content="小C的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="mrxccc">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="小C的博客" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">小C的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://mrxccc.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-常用软件的docker-compose安装文件" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/bf4abdda.html" class="article-date">
  <time class="dt-published" datetime="2022-08-10T03:45:53.000Z" itemprop="datePublished">2022-08-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/docker/">docker</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/bf4abdda.html">常用软件的docker-compose安装文件</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="使用docker-compose安装一些常用软件"><a href="#使用docker-compose安装一些常用软件" class="headerlink" title="使用docker-compose安装一些常用软件"></a>使用docker-compose安装一些常用软件</h2><h3 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h3><p><strong>docker-compose.yaml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql-service:</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0.15</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3307</span><span class="string">:3306</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">Xc58525456</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="string">--default-authentication-plugin=mysql_native_password</span></span><br><span class="line">      <span class="string">--character-set-server=utf8mb4</span></span><br><span class="line">      <span class="string">--collation-server=utf8mb4_general_ci</span></span><br><span class="line">      <span class="string">--explicit_defaults_for_timestamp=true</span></span><br><span class="line">      <span class="string">--lower_case_table_names=1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/docker/mysql/data:/var/lib/mysql</span></span><br></pre></td></tr></table></figure>

<h3 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h3><p><strong>docker-compose.yaml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">80</span><span class="string">:80</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/nginx.conf:/etc/nginx/nginx.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./wwwroot:/usr/share/nginx/wwwroot</span></span><br></pre></td></tr></table></figure>

<p><strong>nginx.conf</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">worker_processes</span>  <span class="number">1</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line"><span class="string">events</span> &#123;</span><br><span class="line">    <span class="string">worker_connections</span>  <span class="number">1024</span><span class="string">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">http</span> &#123;</span><br><span class="line">    <span class="string">include</span>       <span class="string">mime.types;</span></span><br><span class="line">    <span class="string">default_type</span>  <span class="string">application/octet-stream;</span></span><br><span class="line">    <span class="string">sendfile</span>        <span class="string">on;</span></span><br><span class="line">    <span class="string">keepalive_timeout</span>  <span class="number">65</span><span class="string">;</span></span><br><span class="line">    <span class="string">charset</span> <span class="string">utf-8;</span>        <span class="comment"># 设置编码格式</span></span><br><span class="line"></span><br><span class="line">    <span class="string">server</span> &#123;</span><br><span class="line"><span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line">  <span class="string">server_name</span> <span class="number">192.168</span><span class="number">.56</span><span class="number">.10</span><span class="string">;</span></span><br><span class="line">  <span class="string">access_log</span> <span class="string">logs/pbootcms.access.log;</span></span><br><span class="line">  <span class="string">error_log</span> <span class="string">logs/pbootcms.error.log;</span></span><br><span class="line">  <span class="string">index</span> <span class="string">index.html</span> <span class="string">index.htm</span> <span class="string">index.php;</span></span><br><span class="line">  <span class="string">root</span> <span class="string">/home/www/pbootcms;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#include /usr/local/nginx/conf/rewrite/none.conf;</span></span><br><span class="line">  <span class="comment">#error_page 404 /404.html;</span></span><br><span class="line">  <span class="comment">#error_page 502 /502.html;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">    <span class="string">if</span> <span class="string">(!-e</span> <span class="string">$request_filename)</span> &#123;</span><br><span class="line">      <span class="string">rewrite</span> <span class="string">^(.*)$</span> <span class="string">/index.php/$1</span> <span class="string">last;</span></span><br><span class="line">      <span class="comment">#rewrite ^(.*)$ /index.php?s=$1 last;</span></span><br><span class="line">      <span class="string">break;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="string">location</span> <span class="string">~</span> [<span class="string">^/</span>]<span class="string">\.php(/|$)</span> &#123;</span><br><span class="line">    <span class="string">fastcgi_pass</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9000;</span></span><br><span class="line">    <span class="comment">#fastcgi_pass unix:/dev/shm/php-cgi.sock;</span></span><br><span class="line">    <span class="string">fastcgi_index</span> <span class="string">index.php;</span></span><br><span class="line">    <span class="string">include</span> <span class="string">/etc/nginx/fastcgi.conf;</span></span><br><span class="line">    <span class="string">fastcgi_split_path_info</span> <span class="string">^(.+?\.php)(/.*)$;</span></span><br><span class="line">    <span class="string">set</span> <span class="string">$path_info</span> <span class="string">$fastcgi_path_info;</span></span><br><span class="line">    <span class="string">fastcgi_param</span> <span class="string">PATH_INFO</span> <span class="string">$path_info;</span></span><br><span class="line">    <span class="string">fastcgi_param</span>  <span class="string">CI_ENV</span> <span class="string">&#x27;development&#x27;</span><span class="string">;</span></span><br><span class="line">    <span class="string">try_files</span> <span class="string">$fastcgi_script_name</span> <span class="string">=404;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="string">location</span> <span class="string">~</span> <span class="string">.*\.(gif|jpg|jpeg|png|bmp|swf|flv|mp4|ico)$</span> &#123;</span><br><span class="line">    <span class="string">expires</span> <span class="string">30d;</span></span><br><span class="line">    <span class="string">access_log</span> <span class="string">off;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="string">location</span> <span class="string">~</span> <span class="string">.*\.(js|css)?$</span> &#123;</span><br><span class="line">    <span class="string">expires</span> <span class="string">7d;</span></span><br><span class="line">    <span class="string">access_log</span> <span class="string">off;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="string">location</span> <span class="string">~</span> <span class="string">/\.ht</span> &#123;</span><br><span class="line">    <span class="string">deny</span> <span class="string">all;</span></span><br><span class="line">  &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="minio"><a href="#minio" class="headerlink" title="minio"></a>minio</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">minio:</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">minio/minio</span></span><br><span class="line">      <span class="attr">container_name:</span> <span class="string">minio</span></span><br><span class="line">      <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">9001</span><span class="string">:9000</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">8000</span><span class="string">:8000</span></span><br><span class="line">      <span class="attr">command:</span> <span class="string">server</span> <span class="string">--address</span> <span class="string">&#x27;0.0.0.0:9000&#x27;</span>  <span class="string">--console-address</span> <span class="string">&quot;0.0.0.0:8000&quot;</span> <span class="string">/data</span></span><br><span class="line">      <span class="attr">logging:</span></span><br><span class="line">        <span class="attr">options:</span></span><br><span class="line">          <span class="attr">max-size:</span> <span class="string">&quot;50M&quot;</span> <span class="comment"># 最大文件上传限制</span></span><br><span class="line">          <span class="attr">max-file:</span> <span class="string">&quot;10&quot;</span></span><br><span class="line">        <span class="attr">driver:</span> <span class="string">json-file</span></span><br><span class="line">      <span class="attr">environment:</span></span><br><span class="line">        <span class="attr">MINIO_ACCESS_KEY:</span> <span class="string">minio</span>    <span class="comment">#管理后台用户名</span></span><br><span class="line">        <span class="attr">MINIO_SECRET_KEY:</span> <span class="string">minio123</span> <span class="comment">#管理后台密码，最小8个字符</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./data:/data</span>              <span class="comment">#映射当前目录下的data目录至容器内/data目录</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./config:/root/.minio/</span>     <span class="comment">#映射配置目录</span></span><br><span class="line">      <span class="attr">healthcheck:</span></span><br><span class="line">        <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost:9001/minio/health/live&quot;</span>]</span><br><span class="line">        <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">        <span class="attr">timeout:</span> <span class="string">20s</span></span><br><span class="line">        <span class="attr">retries:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<h3 id="elastic-kibana"><a href="#elastic-kibana" class="headerlink" title="elastic-kibana"></a>elastic-kibana</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2.2&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">cerebro:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">lmenezes/cerebro:0.8.3</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">cerebro</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5701:9000&quot;</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-Dhosts.0.host=http://elasticsearch:9200</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">es7net</span></span><br><span class="line">  <span class="attr">kibana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/kibana/kibana:7.1.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kibana7</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">I18N_LOCALE=zh-CN</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">XPACK_GRAPH_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TIMELION_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">XPACK_MONITORING_COLLECTION_ENABLED=&quot;true&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ELASTICSEARCH_USERNAME=kibana</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ELASTICSEARCH_PASSWORD=demo_password</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5601:5601&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">es7net</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:7.1.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es7_01</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=test-es</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.name=es7_01</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;TZ=Asia/Shanghai&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.type=single-node</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">path.data=node0_data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">xpack.security.enabled=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">xpack.security.transport.ssl.enabled=false</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/es7data1:/usr/share/elasticsearch/data</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9200</span><span class="string">:9200</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">es7net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">es7net:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span>	</span><br></pre></td></tr></table></figure>

<h3 id="portainer"><a href="#portainer" class="headerlink" title="portainer"></a>portainer</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">portainer:</span></span><br><span class="line"> <span class="attr">image:</span> <span class="string">portainer/portainer</span></span><br><span class="line"> <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"> <span class="attr">ports:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">&quot;9000:9000&quot;</span></span><br><span class="line"> <span class="attr">volumes:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">/data/docker/portainer/data:/data</span></span><br></pre></td></tr></table></figure>

<h3 id="confluence"><a href="#confluence" class="headerlink" title="confluence"></a>confluence</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">confluence-mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:9.4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">confluence-db</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5432:5432&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">pg123456.</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/confluence/pgsql-data:/var/lib/postgresql/data</span></span><br><span class="line">  <span class="attr">confluence:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">cptactionhank/atlassian-confluence:7.2.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">confluence</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/home/confluence/apps/confluence:/opt/atlassian/confluence&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/home/confluence/data:/var/atlassian/confluence&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8090:8090&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">JAVA_OPTS:</span> <span class="string">-Duser.timezone=Asia/Shanghai</span></span><br><span class="line">      <span class="attr">CATALINA_OPTS:</span> <span class="string">-Xms256m</span> <span class="string">-Xmx2g</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">confluence-mysql</span></span><br></pre></td></tr></table></figure>

<h3 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">master:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-master</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">6379</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">slave1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-slave-1</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">6380</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">--slaveof</span> <span class="string">redis-master</span> <span class="number">6379</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">slave2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-slave-2</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">6381</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">--slaveof</span> <span class="string">redis-master</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure>

<h3 id="wordpress"><a href="#wordpress" class="headerlink" title="wordpress"></a>wordpress</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">   <span class="attr">db:</span></span><br><span class="line">     <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">     <span class="attr">volumes:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">db_data:/var/lib/mysql</span></span><br><span class="line">     <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">     <span class="attr">environment:</span></span><br><span class="line">       <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">somewordpress</span></span><br><span class="line">       <span class="attr">MYSQL_DATABASE:</span> <span class="string">wordpress</span></span><br><span class="line">       <span class="attr">MYSQL_USER:</span> <span class="string">wordpress</span></span><br><span class="line">       <span class="attr">MYSQL_PASSWORD:</span> <span class="string">wordpress</span></span><br><span class="line"></span><br><span class="line">   <span class="attr">wordpress:</span></span><br><span class="line">     <span class="attr">depends_on:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">     <span class="attr">image:</span> <span class="string">wordpress:latest</span></span><br><span class="line">     <span class="attr">ports:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">&quot;8000:80&quot;</span></span><br><span class="line">     <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">     <span class="attr">environment:</span></span><br><span class="line">       <span class="attr">WORDPRESS_DB_HOST:</span> <span class="string">db:3306</span></span><br><span class="line">       <span class="attr">WORDPRESS_DB_USER:</span> <span class="string">wordpress</span></span><br><span class="line">       <span class="attr">WORDPRESS_DB_PASSWORD:</span> <span class="string">wordpress</span></span><br><span class="line">       <span class="attr">WORDPRESS_DB_NAME:</span> <span class="string">wordpress</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">    <span class="attr">db_data:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="zookeeper"><a href="#zookeeper" class="headerlink" title="zookeeper"></a>zookeeper</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">zoo1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper:3.4.11</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">zoo1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zookeeper_1</span></span><br><span class="line">    <span class="comment">#domainname:</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2181</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/docker_app/zookeeper/zoo1/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/docker_app/zookeeper/zoo1/datalog:/datalog</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zoo1:2888:3888</span> <span class="string">server.2=zoo2:2888:3888</span> <span class="string">server.3=zoo3:2888:3888</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">zoo2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper:3.4.11</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">zoo2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zookeeper_2</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2182</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/docker_app/zookeeper/zoo2/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/docker_app/zookeeper/zoo2/datalog:/datalog</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">2</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zoo1:2888:3888</span> <span class="string">server.2=zoo2:2888:3888</span> <span class="string">server.3=zoo3:2888:3888</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">zoo3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper:3.4.11</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">zoo3</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zookeeper_3</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2183</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/docker_app/zookeeper/zoo3/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/docker_app/zookeeper/zoo3/datalog:/datalog</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zoo1:2888:3888</span> <span class="string">server.2=zoo2:2888:3888</span> <span class="string">server.3=zoo3:2888:3888</span></span><br></pre></td></tr></table></figure>

<h3 id="yapi"><a href="#yapi" class="headerlink" title="yapi"></a>yapi</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use root/example as user/password credentials</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mongo:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mongo:4</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MONGO_INITDB_ROOT_USERNAME:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">MONGO_INITDB_ROOT_PASSWORD:</span> <span class="string">Xc58525456</span></span><br><span class="line">      <span class="attr">MONGO_INITDB_DATABASE:</span> <span class="string">yapi</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./mongo-conf:/docker-entrypoint-initdb.d</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./mongo/etc:/etc/mongo</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./mongo/data/db:/data/db</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">27017</span><span class="string">:27017</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;netstat -anp | grep 27017&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">2m</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">yapi:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">yapi</span></span><br><span class="line">    <span class="comment"># 第一次启动使用</span></span><br><span class="line">    <span class="comment"># command: &quot;yapi server&quot;</span></span><br><span class="line">    <span class="comment"># 之后使用下面的命令</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&quot;node /my-yapi/vendors/server/app.js&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./my-yapi:/my-yapi</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9090</span><span class="string">:9090</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3000</span><span class="string">:3000</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mongo</span></span><br></pre></td></tr></table></figure>

<p><strong>mongo-confi&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;init-mongo.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">createUser</span>(&#123; <span class="attr">user</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="attr">pwd</span>: <span class="string">&#x27;admin123456&#x27;</span>, <span class="attr">roles</span>: [ &#123; <span class="attr">role</span>: <span class="string">&quot;root&quot;</span>, <span class="attr">db</span>: <span class="string">&quot;admin&quot;</span> &#125; ] &#125;);</span><br><span class="line"></span><br><span class="line">db.<span class="title function_">auth</span>(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;admin123456&quot;</span>);</span><br><span class="line"> db.<span class="title function_">createUser</span>(&#123;</span><br><span class="line"> <span class="attr">user</span>: <span class="string">&#x27;yapi&#x27;</span>,</span><br><span class="line"> <span class="attr">pwd</span>: <span class="string">&#x27;yapi123456&#x27;</span>,</span><br><span class="line"> <span class="attr">roles</span>: [</span><br><span class="line"> &#123; <span class="attr">role</span>: <span class="string">&quot;dbAdmin&quot;</span>, <span class="attr">db</span>: <span class="string">&quot;yapi&quot;</span> &#125;,</span><br><span class="line"> &#123; <span class="attr">role</span>: <span class="string">&quot;readWrite&quot;</span>, <span class="attr">db</span>: <span class="string">&quot;yapi&quot;</span> &#125;</span><br><span class="line"> ]</span><br><span class="line"></span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>

<p><strong>Dockerfile</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">12</span>-alpine</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> repositories /etc/apk/repositories</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install -g yapi-cli --registry https://registry.npm.taobao.org</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3000</span> <span class="number">9090</span></span><br></pre></td></tr></table></figure>

<p><strong>repositories</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.aliyun.com/alpine/v3.6/main/</span><br><span class="line"></span><br><span class="line">https://mirrors.aliyun.com/alpine/v3.6/community/</span><br></pre></td></tr></table></figure>

<p><strong>readme</strong></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">YApi Docker镜像</span></span><br><span class="line"><span class="section">==============</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">YApi:  https://github.com/YMFE/yapi/releases</span><br><span class="line"></span><br><span class="line">制作本地的yapi docker镜像, docker-compose一键维护和部署.</span><br><span class="line"></span><br><span class="line"><span class="section">## How</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 初始化db, 开启自定义配置</span><br><span class="line"></span><br><span class="line"><span class="code">```</span></span><br><span class="line"><span class="code">git clone https://github.com/Ryan-Miao/docker-yapi.git</span></span><br><span class="line"><span class="code">cd docker-yapi</span></span><br><span class="line"><span class="code">docker-compose up</span></span><br><span class="line"><span class="code">```</span></span><br><span class="line"></span><br><span class="line">打开 localhost:9090</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> 默认部署路径为<span class="code">`/my-yapi`</span>(需要修改docker-compose.yml才可以更改)</span><br><span class="line"><span class="bullet">-</span> 修改管理员邮箱 <span class="code">`ryan.miao@demo.com`</span> (随意, 修改为自己的邮箱)</span><br><span class="line"><span class="bullet">-</span> 修改数据库地址为 <span class="code">`mongo`</span> 或者修改为自己的mongo实例 (docker-compose配置的mongo服务名称叫mongo)</span><br><span class="line"><span class="bullet">-</span> 打开数据库认证</span><br><span class="line"><span class="bullet">-</span> 输入数据库用户名: <span class="code">`yapi`</span>(mongo配置的用户名, 见mongo-conf/init-mongo.js)</span><br><span class="line"><span class="bullet">-</span> 输入密码: <span class="code">`yapi123456`</span>(mongo配置的密码, 见mongo-conf/init-mongo.js)</span><br><span class="line"></span><br><span class="line">点击开始部署.</span><br><span class="line"></span><br><span class="line">![](<span class="link">doc/init.jpg</span>)</span><br><span class="line">![](<span class="link">doc/init-2.jpg</span>)</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> 部署完毕后, 修改docker-compose.yml</span><br><span class="line">启用</span><br><span class="line"></span><br><span class="line"><span class="code">```</span></span><br><span class="line"><span class="code">  yapi:</span></span><br><span class="line"><span class="code">    build:</span></span><br><span class="line"><span class="code">      context: ./</span></span><br><span class="line"><span class="code">      dockerfile: Dockerfile</span></span><br><span class="line"><span class="code">    image: yapi</span></span><br><span class="line"><span class="code">    # 第一次启动使用</span></span><br><span class="line"><span class="code">    # command: &quot;yapi server&quot;</span></span><br><span class="line"><span class="code">    # 之后使用下面的命令</span></span><br><span class="line"><span class="code">    command: &quot;node /my-yapi/vendors/server/app.js&quot;</span></span><br><span class="line"><span class="code">```</span></span><br><span class="line"></span><br><span class="line">重启服务:</span><br><span class="line"></span><br><span class="line"><span class="code">```</span></span><br><span class="line"><span class="code">docker-compose up</span></span><br><span class="line"><span class="code">```</span></span><br><span class="line"></span><br><span class="line">访问 localhost:3000</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> 输入用户名ryan.miao@demo.com(自己输入的管理员邮箱)</span><br><span class="line"><span class="bullet">-</span> 输入密码ymfe.org(默认的初始化密码, 之后可以修改)</span><br><span class="line"></span><br><span class="line">然后可以导入一个swagger的接口数据试试:</span><br><span class="line"></span><br><span class="line">![](<span class="link">doc/start-1.jpg</span>)</span><br><span class="line">![](<span class="link">doc/start-2.jpg</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span> 后台启动</span><br><span class="line"></span><br><span class="line">前台启动确认没问题后, 直接</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://mrxccc.github.io/posts/bf4abdda.html" data-id="cm5kxu8ov00372wu46j0bf63k" data-title="常用软件的docker-compose安装文件" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-IC-dfx常用指令" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/fcf443c1.html" class="article-date">
  <time class="dt-published" datetime="2022-07-12T03:39:02.000Z" itemprop="datePublished">2022-07-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IC/">IC</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/fcf443c1.html">IC-dfx常用指令</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="安装dfx-sdk"><a href="#安装dfx-sdk" class="headerlink" title="安装dfx sdk"></a>安装dfx sdk</h3><p>安装最新版：</p>
<p><code>sh -ci &quot;$(curl -fsSL https://sdk.dfinity.org/install.sh)&quot;</code></p>
<p>安装指定版本：</p>
<p><code>DFX_VERSION=0.9.3 sh -ci &quot;$(curl -fsSL https://sdk.dfinity.org/install.sh)&quot;</code></p>
<h2 id="dfx常用指令"><a href="#dfx常用指令" class="headerlink" title="dfx常用指令"></a>dfx常用指令</h2><h3 id="identity"><a href="#identity" class="headerlink" title="identity"></a>identity</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dfx identity list #identity 列表</span><br><span class="line">dfx identity get-principal #获取当前的PID</span><br><span class="line">dfx ledger account-id #接收转账的account-id</span><br><span class="line">dfx --identity default ledger --network ic balance #当前账户还有多少ICP</span><br><span class="line">fx --identity xxxx ledger --network ic transfer --memo 0 --amount 0.5 $(dfx --identity default ledger account-id) #从一个账户转账到另一个账户</span><br><span class="line">dfx identity new  developer  #创建新的identity</span><br><span class="line">dfx identity use developer #切换identity</span><br></pre></td></tr></table></figure>

<h3 id="wallet"><a href="#wallet" class="headerlink" title="wallet"></a>wallet</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dfx identity --network ic get-wallet # 获取燃料钱包</span><br><span class="line">dfx ledger --network ic create-canister --amount 0.0 $(dfx identity get-principal) #创建一个canister,创建之后没有钱包</span><br><span class="line">dfx identity --network ic deploy-wallet xxxxx-xxxxx-xxxxx-xxxxx-xxx # 把钱包部署到canister里面shu</span><br><span class="line">dfx wallet --network ic balance #当前钱包的cycles余额</span><br><span class="line">dfx wallet --network ic send $(dfx --identity developer identity get-wallet) 80000590000 #给developer充值  </span><br></pre></td></tr></table></figure>

<h3 id="deploy"><a href="#deploy" class="headerlink" title="deploy"></a>deploy</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dfx deploy #部署到本地</span><br><span class="line">dfx deploy --network ic --with--cycles 80000590000 xxx #部署到主网</span><br></pre></td></tr></table></figure>

<h3 id="canister"><a href="#canister" class="headerlink" title="canister"></a>canister</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dfx canister --network ic status --all #获取canister状态</span><br><span class="line">dfx canister --network ic stop --all # 停止</span><br><span class="line">dfx canister --network ic uninstall-code --all #删除代码</span><br><span class="line">dfx canistet --network ic delete -all #删除并回收cycles</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://mrxccc.github.io/posts/fcf443c1.html" data-id="cm5kxu8nv00112wu40jryg0sn" data-title="IC-dfx常用指令" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IC/" rel="tag">IC</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-IC-Canister内存模型与StableMemory管理" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/673d0c97.html" class="article-date">
  <time class="dt-published" datetime="2022-07-11T08:35:39.000Z" itemprop="datePublished">2022-07-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IC/">IC</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/673d0c97.html">IC-Canister内存模型与StableMemory管理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1-Canister的内存模型"><a href="#1-Canister的内存模型" class="headerlink" title="1.Canister的内存模型"></a>1.Canister的内存模型</h1><ul>
<li>WebAssembly内存模型简介</li>
<li>运行时内存与Statble内存</li>
<li>运行时内存与GC选择</li>
<li>使用Prim库获取内存状态</li>
</ul>
<h2 id="1-1-WebAssembly内存模型简介"><a href="#1-1-WebAssembly内存模型简介" class="headerlink" title="1.1 WebAssembly内存模型简介"></a>1.1 WebAssembly内存模型简介</h2><h3 id="canister与wasm"><a href="#canister与wasm" class="headerlink" title="canister与wasm"></a>canister与wasm</h3><p>Motoko和Rust的代码都会编译为wasm，canister会以wasm来执行。而wasm的内存管理就会格外重要</p>
<h3 id="wasm内存模型"><a href="#wasm内存模型" class="headerlink" title="wasm内存模型"></a>wasm内存模型</h3><ul>
<li>页式内存<ul>
<li>webabssembly的内存管理形式为页式管理，对内存进行分页，每页64KB</li>
</ul>
</li>
<li>线性增长<ul>
<li>webassembly的内存一经分配不能收回，本质上，wasm的内存时一个数组，数组每个元素表示内存页，每页64KB（65536byte），共65536页，共4G</li>
<li>4G的原因：目前IC使用的wasm标准为wasm32，因为时32位指针域。因此最大只能存储4G（2^32个byte）</li>
</ul>
</li>
</ul>
<h3 id="canister内存模型"><a href="#canister内存模型" class="headerlink" title="canister内存模型"></a>canister内存模型</h3><p>​	canister目前最大可使用内存为12G</p>
<h3 id="运行时内存与GC（Garbage-Collection）"><a href="#运行时内存与GC（Garbage-Collection）" class="headerlink" title="运行时内存与GC（Garbage Collection）"></a>运行时内存与GC（Garbage Collection）</h3><p>IC的垃圾回收很多都可以参考java的jvm虚拟机的GC算法和垃圾回收器</p>
<h4 id="coping-gc-也称为Minor-GC"><a href="#coping-gc-也称为Minor-GC" class="headerlink" title="coping gc(也称为Minor GC):"></a>coping gc(也称为Minor GC):</h4><p>基于拷贝算法的垃圾回收</p>
<p>将内存分割为from和to两块区域，当触发gc时会拷贝(from-&gt;t0)和清除（from），同时下一次GC时，有数据的就变成了from，清除完毕的区域变成了to</p>
<h4 id="compacting-gc："><a href="#compacting-gc：" class="headerlink" title="compacting gc："></a>compacting gc：</h4><p>标记整理算法的垃圾回收</p>
<p>便利heap，找出所有活体对象（正在活动&#x2F;被活动的对象引用），标记活体对象。标记完后剩下的就是不被引用或者不再使用的对象，及内存垃圾。然清理内存垃圾并整理活体对象</p>
<h4 id="Prim库"><a href="#Prim库" class="headerlink" title="Prim库"></a>Prim库</h4><p>RTS:Run Time System运行时系统</p>
<h3 id="ExperimentalStableMemory库"><a href="#ExperimentalStableMemory库" class="headerlink" title="ExperimentalStableMemory库"></a>ExperimentalStableMemory库</h3><p>升级时要留下足够空间用来存储升级时canister内的运行时状态数据</p>
<h1 id="2-StableMemory管理"><a href="#2-StableMemory管理" class="headerlink" title="2.StableMemory管理"></a>2.StableMemory管理</h1><ul>
<li>ExperimentalStableMemory库的使用讲解</li>
<li>Bucket库的使用</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mrxccc.github.io/posts/673d0c97.html" data-id="cm5kxu8nu000z2wu4fub2fdle" data-title="IC-Canister内存模型与StableMemory管理" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IC/" rel="tag">IC</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Java表格处理-easyexcel框架使用和进阶" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/7963a255.html" class="article-date">
  <time class="dt-published" datetime="2022-02-11T09:31:26.000Z" itemprop="datePublished">2022-02-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%A1%A8%E6%A0%BC%E5%A4%84%E7%90%86/">表格处理</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/7963a255.html">Java表格处理-easyexcel框架使用和进阶</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="对表格对象追加操作"><a href="#对表格对象追加操作" class="headerlink" title="对表格对象追加操作"></a>对表格对象追加操作</h2><p>使用easyexcel，使用注解模板一般操作如下</p>
<p><strong>注解模板</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import com.alibaba.excel.annotation.ExcelProperty;</span><br><span class="line">import com.alibaba.excel.annotation.write.style.*;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.EqualsAndHashCode;</span><br><span class="line">import org.apache.poi.ss.usermodel.FillPatternType;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Author:   caijc</span><br><span class="line"> * Date:     2022/1/25 10:48</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">@EqualsAndHashCode</span><br><span class="line">// 头单元格样式</span><br><span class="line">@HeadStyle(fillPatternType = FillPatternType.SOLID_FOREGROUND, fillForegroundColor = 44)</span><br><span class="line">@HeadFontStyle(fontHeightInPoints = 12)</span><br><span class="line">public class BusinessTravelSalesDailyData &#123;</span><br><span class="line">    @ExcelProperty(&#123;&quot;统计时间&quot;, &quot;企业名称&quot;&#125;)</span><br><span class="line">    private String corpName;</span><br><span class="line"></span><br><span class="line">    @ExcelProperty(&#123;&quot;统计时间&quot;,&quot;客户经理&quot;&#125;)</span><br><span class="line">    private String manager;</span><br><span class="line"></span><br><span class="line">    @ExcelProperty(&#123;&quot;年交易总额&quot;,&quot;交易总额&quot;&#125;)</span><br><span class="line">    private Double totalAmount;</span><br><span class="line"></span><br><span class="line">    @ExcelProperty(&#123;&quot;年交易总额&quot;,&quot;去年同期交易总额&quot;&#125;)</span><br><span class="line">    private Double lastYearTotalAmount;</span><br><span class="line"></span><br><span class="line">    @ExcelProperty(&#123;&quot;国内机票&quot;,&quot;单量总计&quot;&#125;)</span><br><span class="line">    private Long dftOrderQuantity;</span><br><span class="line"></span><br><span class="line">    @ExcelProperty(&#123;&quot;国内机票&quot;,&quot;去年同期单量&quot;&#125;)</span><br><span class="line">    private Long dftLastYearOrderQuantity;</span><br><span class="line"></span><br><span class="line">    @ExcelProperty(&#123;&quot;国内机票&quot;,&quot;毛利&quot;&#125;)</span><br><span class="line">    private Double dftGrossMargin;</span><br><span class="line"></span><br><span class="line">    @ExcelProperty(&#123;&quot;国内机票&quot;,&quot;去年同期毛利&quot;&#125;)</span><br><span class="line">    private Double dftLastYearGrossMargin;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>生成表格</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">List&lt;BusinessTravelSalesDailyData&gt; dataList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">try</span> (<span class="type">BufferedOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file))) &#123;</span><br><span class="line">            EasyExcel.write(out, BusinessTravelSalesDailyData.class)</span><br><span class="line">                    .excelType(ExcelTypeEnum.XLSX)</span><br><span class="line">                    .sheet(<span class="number">0</span>, sheetName)</span><br><span class="line">                    .doWrite(dataList);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;数据生成完毕 写入失败&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>因为在调用完<code>doWrite()</code>方法后，excel文件就已经生成，这时想再对表格进行操作，比如在表尾添加一个合计行，或者对已生成的数据进行额外操作，就必须再读取生成好的excel文件，进行后续操作。这样的追加操作就变得比较复杂</p>
<p>其实有一个比较好的方式可以很好实现追加操作</p>
<p>在分析源码的过程中，跟踪<code>doWrite()</code>方法，发现，在写入excel文件之前，会调用所有实现<code>WorkbookWriteHandler</code>接口的实现，所以，实现一个<code>WorkbookWriteHandler</code>实现类来完成追加操作</p>
<p>下面代码，是在表尾生成一个包含合计的单元格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 数据</span><br><span class="line">        List&lt;BusinessTravelSalesDailyData&gt; dataList = new ArrayList&lt;&gt;();</span><br><span class="line">        Integer sum = getSum(list, yearAmount);</span><br><span class="line">        try (BufferedOutputStream out = new BufferedOutputStream(new FileOutputStream(file))) &#123;</span><br><span class="line">            EasyExcel.write(out, BusinessTravelSalesDailyData.class)</span><br><span class="line">                    .excelType(ExcelTypeEnum.XLSX)</span><br><span class="line">                    .registerWriteHandler(new CustomSumDataHandler(sum)) // 设置合计填充数据</span><br><span class="line">                    .sheet(0, sheetName)</span><br><span class="line">                    .doWrite(dataList);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;数据生成完毕 写入失败&quot;, e);</span><br><span class="line">            throw e;</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(file.getAbsolutePath());</span><br><span class="line">        return file;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huoli.ctar.tmc.csa.csm.job.statsRpt.excel.handle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.write.handler.WorkbookWriteHandler;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.write.metadata.holder.WriteWorkbookHolder;</span><br><span class="line"><span class="keyword">import</span> com.huoli.ctar.tmc.vo.BusinessTravelSalesDailyEmailVo;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.util.CellRangeAddress;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author:   caijc</span></span><br><span class="line"><span class="comment"> * Date:     2022/2/9 14:29</span></span><br><span class="line"><span class="comment"> * Description: 自定义合计列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomSumDataHandler</span> <span class="keyword">implements</span> <span class="title class_">WorkbookWriteHandler</span> &#123;</span><br><span class="line">    Integer sum;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomSumDataHandler</span><span class="params">(Integer sum)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sum = sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeWorkbookCreate</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterWorkbookCreate</span><span class="params">(WriteWorkbookHolder writeWorkbookHolder)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterWorkbookDispose</span><span class="params">(WriteWorkbookHolder writeWorkbookHolder)</span> &#123;</span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> writeWorkbookHolder.getWorkbook().getSheetAt(<span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">lastRowNum</span> <span class="operator">=</span> sheet.getLastRowNum();</span><br><span class="line">        <span class="type">int</span> <span class="variable">sumRowIndex</span> <span class="operator">=</span> lastRowNum+<span class="number">1</span>;</span><br><span class="line">        <span class="type">Row</span> <span class="variable">row</span> <span class="operator">=</span> sheet.createRow(sumRowIndex);</span><br><span class="line">        <span class="type">CellStyle</span> <span class="variable">cellStyle</span> <span class="operator">=</span> writeWorkbookHolder.getWorkbook().createCellStyle();</span><br><span class="line">        cellStyle.setAlignment(HorizontalAlignment.CENTER_SELECTION);</span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cellA1</span> <span class="operator">=</span> row.createCell(<span class="number">0</span>);</span><br><span class="line">        cellA1.setCellValue(<span class="string">&quot;总计:&quot;</span> + sum);</span><br><span class="line">        cellA1.setCellStyle(cellStyle);</span><br><span class="line">        <span class="type">CellRangeAddress</span> <span class="variable">cra</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CellRangeAddress</span>(row.getRowNum(), row.getRowNum(), <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 合并单元格</span></span><br><span class="line">        sheet.addMergedRegion(cra);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://mrxccc.github.io/posts/7963a255.html" data-id="cm5kxu8o5001n2wu49znpbchr" data-title="Java表格处理-easyexcel框架使用和进阶" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/POI/" rel="tag">POI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/easyexcel/" rel="tag">easyexcel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%A1%A8%E6%A0%BC%E5%A4%84%E7%90%86/" rel="tag">表格处理</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Java表格处理-两个excel之间的数据拷贝" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/c0cda934.html" class="article-date">
  <time class="dt-published" datetime="2022-02-11T03:35:22.000Z" itemprop="datePublished">2022-02-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%A1%A8%E6%A0%BC%E5%A4%84%E7%90%86/">表格处理</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/c0cda934.html">Java表格处理-两个excel之间的数据拷贝</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="POI介绍"><a href="#POI介绍" class="headerlink" title="POI介绍"></a>POI介绍</h3><p>ApachePOI是用Java编写的免费开源的跨平台的JavaAPI，ApachePOI提供API给Java程序对MicrosoftOffice格式档案读和写的功能，其中使用最多的就是使用POI操作Excel文件。</p>
<p>maven坐标依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>POI结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HSSF－提供读写MicrosoftExcelXLS格式档案的功能</span><br><span class="line">XSSF－提供读写MicrosoftExcelOOXMLXLSX格式档案的功能</span><br><span class="line">HWPF－提供读写MicrosoftWordDOC格式档案的功能</span><br><span class="line">HSLF－提供读写MicrosoftPowerPoint格式档案的功能</span><br><span class="line">HDGF－提供读MicrosoftVisio格式档案的功能</span><br><span class="line">HPBF－提供读MicrosoftPublisher格式档案的功能</span><br><span class="line">HSMF－提供读MicrosoftOutlook格式档案的功能</span><br></pre></td></tr></table></figure>

<p>关于POI中基础API的使用，就不多介绍了，本文主要介绍对<strong>excel的处理-两个excel之间的数据拷贝</strong></p>
<p>话不多说，现在开始！！</p>
<h3 id="单元格样式个数限制"><a href="#单元格样式个数限制" class="headerlink" title="单元格样式个数限制"></a>单元格样式个数限制</h3><p>首先介绍一下POI中excel的单元格样式，工作簿Workbook中单元格样式个数是有限制的，所以在 程序中应该重复使用相同CellStyle，而不是为每个单元 格创建一个CellStyle</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HSSFCellStyle - 4000个</span><br><span class="line">XSSFCellStyle - 64000个</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>最大行数</th>
<th>最大列数</th>
<th>单元格样式个数</th>
<th>文本单元格最大长度</th>
<th>一个单元格上条件样式最大个数</th>
</tr>
</thead>
<tbody><tr>
<td>HSSF</td>
<td>65536</td>
<td>256(2^8)</td>
<td>4000</td>
<td>32767</td>
<td>3</td>
</tr>
<tr>
<td>XSSF</td>
<td>1048576</td>
<td>16384(2^14)</td>
<td>64000</td>
<td></td>
<td>Integer.MAX_VALUE</td>
</tr>
</tbody></table>
<p>其实在<code>Workbook</code>的<code>createCellStyle()</code>方法中，可以看到各个表格格式实现类对单元格样式的限制</p>
<p>如<strong>HSSFCellStyle</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * The maximum number of cell styles in a .xls workbook.</span></span><br><span class="line"><span class="comment">    * The &#x27;official&#x27; limit is 4,000, but POI allows a slightly larger number.</span></span><br><span class="line"><span class="comment">    * This extra delta takes into account built-in styles that are automatically</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * See http://office.microsoft.com/en-us/excel-help/excel-specifications-and-limits-HP005199291.aspx</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_STYLES</span> <span class="operator">=</span> <span class="number">4030</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Create a new Cell style and add it to the workbook&#x27;s style table.</span></span><br><span class="line"><span class="comment">    * You can define up to 4000 unique styles in a .xls workbook.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> the new Cell Style object</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> IllegalStateException if the number of cell styles exceeded the limit for this type of Workbook.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> HSSFCellStyle <span class="title function_">createCellStyle</span><span class="params">()</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">if</span>(workbook.getNumExFormats() == MAX_STYLES) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;The maximum number of cell styles was exceeded. &quot;</span> +</span><br><span class="line">                   <span class="string">&quot;You can define up to 4000 styles in a .xls workbook&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">ExtendedFormatRecord</span> <span class="variable">xfr</span> <span class="operator">=</span> workbook.createCellXF();</span><br><span class="line">       <span class="type">short</span> <span class="variable">index</span> <span class="operator">=</span> (<span class="type">short</span>) (getNumCellStyles() - <span class="number">1</span>);</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HSSFCellStyle</span>(index, xfr, <span class="built_in">this</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>HSSFCellStyle</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Excel2007</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;ul&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;The total number of available rows is 1M (2^20)&lt;/li&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;The total number of available columns is 16K (2^14)&lt;/li&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;The maximum number of arguments to a function is 255&lt;/li&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;Number of conditional format conditions on a cell is unlimited</span></span><br><span class="line"><span class="comment">     * (actually limited by available memory in Excel)&lt;/li&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;Number of cell styles is 64000&lt;/li&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;Length of text cell contents is 32767&lt;/li&gt;</span></span><br><span class="line"><span class="comment">     * &lt;ul&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    EXCEL2007(<span class="number">0x100000</span>, <span class="number">0x4000</span>, <span class="number">255</span>, Integer.MAX_VALUE, <span class="number">64000</span>, <span class="number">32767</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Is this right? Number formats (XSSFDataFormat) and cell styles (XSSFCellStyle) are different. What&#x27;s up with the plus 1?</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAXIMUM_STYLE_ID</span> <span class="operator">=</span> SpreadsheetVersion.EXCEL2007.getMaxCellStyles();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> XSSFCellStyle <span class="title function_">createCellStyle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.getNumCellStyles() &gt; MAXIMUM_STYLE_ID) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;The maximum number of Cell Styles was exceeded. You can define up to &quot;</span> + MAXIMUM_STYLE_ID + <span class="string">&quot; style in a .xlsx Workbook&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">xfSize</span> <span class="operator">=</span> <span class="built_in">this</span>.styleXfs.size();</span><br><span class="line">            <span class="type">CTXf</span> <span class="variable">xf</span> <span class="operator">=</span> org.openxmlformats.schemas.spreadsheetml.x2006.main.CTXf.Factory.newInstance();</span><br><span class="line">            xf.setNumFmtId(<span class="number">0L</span>);</span><br><span class="line">            xf.setFontId(<span class="number">0L</span>);</span><br><span class="line">            xf.setFillId(<span class="number">0L</span>);</span><br><span class="line">            xf.setBorderId(<span class="number">0L</span>);</span><br><span class="line">            xf.setXfId(<span class="number">0L</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">indexXf</span> <span class="operator">=</span> <span class="built_in">this</span>.putCellXf(xf);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">XSSFCellStyle</span>(indexXf - <span class="number">1</span>, xfSize - <span class="number">1</span>, <span class="built_in">this</span>, <span class="built_in">this</span>.theme);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>所以，如果在拷贝两个<code>Workbook</code>的数据时，数据单元格数量过多，频繁使用createCellStyle()方法创建单元格样式，会导致单元格样式超出限制。</p>
<p>所以，为了解决单元格样式限制问题，可以将样式缓存起来，具体方法可见如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huoli.ctar.cms.poi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.hssf.usermodel.HSSFCellStyle;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.hssf.usermodel.HSSFWorkbook;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.util.CellRangeAddress;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFWorkbook;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author:   caijc</span></span><br><span class="line"><span class="comment"> * Date:     2022/1/5 10:28</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">POICopyHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 缓存单元格的样式索引，key是拷贝原表格的样式索引id,value是拷贝目标表格的样式id</span></span><br><span class="line">    Map&lt;Short,Short&gt; styleMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> Workbook fromWorkbook;</span><br><span class="line">    <span class="keyword">private</span> Workbook toWorkbook;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造方法，将原表格的所有样式一并拷贝到目标表格，并将表格样式索引缓存</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">POICopyHandler</span><span class="params">(Workbook fromWorkbook, Workbook toWorkbook)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fromWorkbook = fromWorkbook;</span><br><span class="line">        <span class="built_in">this</span>.toWorkbook = toWorkbook;</span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">fromSheet</span> <span class="operator">=</span> fromWorkbook.getSheetAt(<span class="number">0</span>);</span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">toSheet</span> <span class="operator">=</span> fromWorkbook.getSheetAt(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (toSheet == <span class="literal">null</span>)&#123;</span><br><span class="line">            toWorkbook.createSheet();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> fromSheet.getFirstRowNum(); i &lt;= fromSheet.getLastRowNum(); i++) &#123;</span><br><span class="line">            <span class="type">Row</span> <span class="variable">fromRow</span> <span class="operator">=</span> fromSheet.getRow(i);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> fromRow.getFirstCellNum(); j &lt; fromRow.getPhysicalNumberOfCells(); j++) &#123;</span><br><span class="line">                <span class="type">Cell</span> <span class="variable">fromCell</span> <span class="operator">=</span> fromRow.getCell(j);</span><br><span class="line">                <span class="type">CellStyle</span> <span class="variable">fromStyle</span> <span class="operator">=</span> fromCell.getCellStyle();</span><br><span class="line">                <span class="keyword">if</span>(!styleMap.containsKey(fromStyle.getIndex()))&#123;</span><br><span class="line">                    <span class="type">CellStyle</span> <span class="variable">toStyle</span> <span class="operator">=</span> toWorkbook.createCellStyle();</span><br><span class="line">                    toStyle.cloneStyleFrom(fromStyle);</span><br><span class="line">                    styleMap.put(fromStyle.getIndex(), toStyle.getIndex());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 复制行</span></span><br><span class="line"><span class="comment">     * 此方法主要用于复制2个不同Workbook间的行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">copySingleRows</span><span class="params">(<span class="type">int</span> fromSheetIndex, <span class="type">int</span> toSheetIndex, <span class="type">int</span> fromRowIndex, <span class="type">int</span> toRowIndex)</span> &#123;</span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">fromSheet</span> <span class="operator">=</span> fromWorkbook.getSheetAt(fromSheetIndex);</span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">toSheet</span> <span class="operator">=</span> toWorkbook.getSheetAt(toSheetIndex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((fromRowIndex == -<span class="number">1</span>) || (fromRowIndex == -<span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置列宽</span></span><br><span class="line">        <span class="type">Row</span> <span class="variable">fromRow</span> <span class="operator">=</span> fromSheet.getRow(fromRowIndex);</span><br><span class="line">        <span class="keyword">if</span> (fromRow == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> fromRow.getLastCellNum(); i &gt;= fromRow.getFirstCellNum(); i--) &#123;</span><br><span class="line">            toSheet.setColumnWidth(i, fromSheet.getColumnWidth(i));</span><br><span class="line">            toSheet.setColumnHidden(i, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 拷贝行并填充数据</span></span><br><span class="line">        <span class="type">Row</span> <span class="variable">toRow</span> <span class="operator">=</span> toSheet.createRow(toRowIndex);</span><br><span class="line">        toRow.setHeight(fromRow.getHeight());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> fromRow.getFirstCellNum(); j &lt;= fromRow.getPhysicalNumberOfCells(); j++) &#123;</span><br><span class="line">            <span class="type">Cell</span> <span class="variable">fromCell</span> <span class="operator">=</span> fromRow.getCell(j);</span><br><span class="line">            <span class="type">Cell</span> <span class="variable">toCell</span> <span class="operator">=</span> toRow.createCell(j);</span><br><span class="line">            <span class="keyword">if</span> (fromCell != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">CellStyle</span> <span class="variable">fromStyle</span> <span class="operator">=</span> fromCell.getCellStyle();</span><br><span class="line">                <span class="type">CellStyle</span> <span class="variable">toStyle</span> <span class="operator">=</span> toWorkbook.getCellStyleAt(styleMap.get(fromStyle.getIndex()));</span><br><span class="line">                <span class="keyword">if</span> (toStyle != <span class="literal">null</span>)&#123;</span><br><span class="line">                    toCell.setCellStyle(toStyle);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">switch</span> (fromCell.getCellTypeEnum()) &#123;</span><br><span class="line">                    <span class="keyword">case</span> BOOLEAN:</span><br><span class="line">                        toCell.setCellValue(fromCell.getBooleanCellValue());</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> ERROR:</span><br><span class="line">                        toCell.setCellErrorValue(fromCell.getErrorCellValue());</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> FORMULA:</span><br><span class="line">                        toCell.setCellFormula(parseFormula(fromCell.getCellFormula()));</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> NUMERIC:</span><br><span class="line">                        <span class="keyword">if</span>(DateUtil.isCellDateFormatted(fromCell))&#123;</span><br><span class="line">                            toCell.setCellValue(sdf.format(fromCell.getDateCellValue()));</span><br><span class="line">                        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                            toCell.setCellValue(fromCell.getNumericCellValue());</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> STRING:</span><br><span class="line">                        toCell.setCellValue(fromCell.getRichStringCellValue());</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">parseFormula</span><span class="params">(String pPOIFormula)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">cstReplaceString</span> <span class="operator">=</span> <span class="string">&quot;ATTR(semiVolatile)&quot;</span>; <span class="comment">//$NON-NLS-1$</span></span><br><span class="line">        StringBuffer result;</span><br><span class="line">        <span class="type">int</span> index;</span><br><span class="line"></span><br><span class="line">        result = <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        index = pPOIFormula.indexOf(cstReplaceString);</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            result.append(pPOIFormula, <span class="number">0</span>, index);</span><br><span class="line">            result.append(pPOIFormula.substring(index + cstReplaceString.length()));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result.append(pPOIFormula);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>调用示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">POICopyHandler</span> <span class="variable">poiCopyHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POICopyHandler</span>(fromWorkbook, toWorkbook);</span><br><span class="line">poiCopyHandler.copySingleRows(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);<span class="comment">// 四个参数分别是：源Workbook的sheet索引，目标Workbook的sheet索引，源Workbook的行索引，目标Workbook的行索引</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mrxccc.github.io/posts/c0cda934.html" data-id="cm5kxu8o5001p2wu4bx0u7dcf" data-title="Java表格处理-两个excel之间的数据拷贝" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/POI/" rel="tag">POI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%A1%A8%E6%A0%BC%E5%A4%84%E7%90%86/" rel="tag">表格处理</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-以太网络-油价和油量" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/54f317bf.html" class="article-date">
  <time class="dt-published" datetime="2022-01-12T07:54:42.000Z" itemprop="datePublished">2022-01-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/54f317bf.html">以太网络 - 油价和油量</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>以太网络是区块链2.0，建立了区块链生态。很多token，也只是以太网络的应用（智能合约）。以太网络进行交易的时候，除了设置对方地址，传输token的类型（以太就是ETH）和数量外，还需要设置油费。油费就是以太网络交易的手续费，这些油费被把交易打包的以太矿工获得。</p>
<p>油费的计算公式：油费 &#x3D; 油价 * 油量。</p>
<p><strong>1）油价</strong></p>
<p>介绍油价之前，先介绍一下以太网络中的计量单位：</p>
<p><strong>wei - 以太最小的计量单位</strong></p>
<p>Kwei - 1e3 wei</p>
<p>Mwei - 1e6 wei</p>
<p><strong>Gwei - 1e9 wei</strong></p>
<p>microether - 1e12 wei</p>
<p>milliether - 1e15 wei</p>
<p><strong>ether - 1e18 wei</strong></p>
<p>矿工在打包交易的时候，会优先挑选油价高的交易。也就是说，设置高油价的交易可能会尽快被矿工接受，被打包进区块。很简单的道理，以太网络拥堵的时候，越高的油价，越容易，越快被打包。</p>
<p><strong>2）油量</strong></p>
<p>油量取决于以太应用的复杂程序。众所周知，以太程序是运行在以太虚拟机（EVM）上的。以太定义了跑在EVM上的每个指令耗费的油量。也就是说，程序一旦确定，相应的虚拟机上的指令也就确定，运行这段程序的油量也就确定。**如果设置的油量超过程序运行需要的油量，多余的油量会退回。如果设置的油量不够程序运行结束，以太会报告 - Out of gas（油量不够）的错误。注意的是：油量不够的情况下，首先交易没有完成，其次耗费的油费也浪费了。<br>**</p>
<p><strong>3）油费</strong></p>
<p>举个例子，如果油价是20 gwei，油量是10000的话，油费是：</p>
<p>   20<em>1e9</em>10000&#x2F;1e18 &#x3D; 0.0002 ether</p>
<p>理解了油价和油量的概念，很容易发现，一次交易，要想又快又便宜的完成，寻找合适的油价（油量是和程序相关固定的，油量可以设置的大一些）</p>
<p><strong>4）如何寻找当前合适的油价？</strong></p>
<p>因为以太是个开发的生态，任何人可以查看以太当前的交易记录。所以，可以通过查看以太当前交易使用的油价来估算自己交易需要的油价。推荐etherscan.io查看交易情况。</p>
<p><img src="/img/54f317bf-1.jpg" alt="54f317bf-1.jpg"></p>
<p>点击最近的交易记录，可以查看详细的交易信息：</p>
<p><img src="/img/54f317bf-2.jpg" alt="54f317bf-2.jpg"></p>
<p>以上的示例交易中，油价是8 gwei。可以知道，目前交易使用油价8 gwei就可以。你可以多看几个交易确定油价。想尽快的交易，就在目前平均水平上加点油价。不要求速度，甚至可以在目前油价基础上减去一些。看历史的交易记录，你会发现还有好些交易是用1gwei的油价的。</p>
<p><strong>5）imToken应用油价和油量的设置</strong></p>
<p>imToken应用在转帐的默认界面，可以设置油量（拖动油量的进度框）。</p>
<p><img src="/img/54f317bf-3.jpg" alt="54f317bf-3.jpg"></p>
<p>在默认情况下，需要注意的是：</p>
<p>1）油价是程序固定的（这个固定的油价有可能太高（浪费），有可能太低（无法及时被矿工处理）。</p>
<p>2）油量即使拉到最大也有可能还是不够。特别是对于一些复杂的智能合约，油量需要300000的。</p>
<p>对于理解了油价和油量的小伙伴，可以直接使用高级选项，自己轻松设置。</p>
<p><img src="/img/54f317bf-4.jpg" alt="54f317bf-4.jpg"></p>
<p>所谓的高级设置，也就是两个选项，一个设置油价（以gwei为单位），一个设置油量。非常简单。上图中就是设置油价是8 gwei，油量是300000。</p>
<p>转载：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/khRgVcjioPNeD3DO1xV2TA">https://mp.weixin.qq.com/s/khRgVcjioPNeD3DO1xV2TA</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mrxccc.github.io/posts/54f317bf.html" data-id="cm5kxu8op002w2wu43xldcsp5" data-title="以太网络 - 油价和油量" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">区块链</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Defi-Compound VS Aave" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/73c3e7b2.html" class="article-date">
  <time class="dt-published" datetime="2021-03-20T02:05:29.000Z" itemprop="datePublished">2021-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/73c3e7b2.html">Compound vs Aave</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Compound-vs-Aave"><a href="#Compound-vs-Aave" class="headerlink" title="Compound vs Aave"></a>Compound vs Aave</h1><blockquote>
<p> 比较这两种Deif产品前先简单介绍一下两个产品</p>
</blockquote>
<h2 id="Compound介绍"><a href="#Compound介绍" class="headerlink" title="Compound介绍"></a>Compound介绍</h2><p>Compound是运行在以太坊上的数字资产理财和贷款服务平台，他通过一个开源的、去中心化的Compound协议，自动建立市场化的利率定价，为用户提供类似银行的数字货币存贷业务，用户存入对应的数字货币资产会立即产生收益，也可也通过抵押的方式借出数字资产，当然要支付利息，利率根据市场供需水平浮动定价，并且按照以太坊区块产生时间，也就是大概每15s，结算一次利息，用户的存款可以随时连本带息的取出。</p>
<h3 id="创始团队"><a href="#创始团队" class="headerlink" title="创始团队"></a>创始团队</h3><p><img src="/img/image-20210320114216820.png" alt="image-20210320114216820"></p>
<p>Compound总部位于旧金山，创始人是CEO Robert Leshner 和CTO Geoffrey Hayes，Robert曾是金融业从业者，是旧金山收入债券委员会的联合主席，他和CTO Geoffrey曾经一起合作创立过两家还不错的公司，一个叫Postmates，是一个提供外卖跑腿服务的APP，另一个项目叫Safe Shepard，是一个致力于保护用户隐私，防各类骚扰的信息安全平台。</p>
<h3 id="融资情况"><a href="#融资情况" class="headerlink" title="融资情况"></a>融资情况</h3><p><img src="/img/image-20210320115334296.png" alt="image-20210320115334296"></p>
<p>Compound 2018年获得8.2M美元的种子轮，2019年获得25M美元的A轮融资，投资人都是全球最顶级的VC。</p>
<p>包括A16Z，Polychanin，Coinbase，Bain Captial</p>
<blockquote>
<p>Bain Captial 就是曾经代表美国共和党与奥巴吗竞选美国总统的Romney创立的那个贝恩资本</p>
</blockquote>
<h3 id="市场数据"><a href="#市场数据" class="headerlink" title="市场数据"></a>市场数据</h3><p><img src="/img/image-20210320120435198.png" alt="image-20210320120435198"></p>
<p>截至目前2021-03-20，compound的Total supply市场存款额是约$122亿，Total Borrow借款额约$54亿。</p>
<p><img src="/img/image-20210320121107638.png" alt="image-20210320121107638"></p>
<p>当前的Top3市场是Eth、USDC、Dai</p>
<h3 id="利率模型"><a href="#利率模型" class="headerlink" title="利率模型"></a>利率模型</h3><p><strong>compound对不同市场采用不通的利率定价模型</strong></p>
<p>以TOP1 Eth的利率模型为例</p>
<p><img src="/img/image-20210320121300795.png" alt="image-20210320121300795"></p>
<blockquote>
<p>黑线：市场资金利用率<br>绿线：存币市场的利率<br>紫线：借币市场利率</p>
</blockquote>
<p>当市场的资金利用率越高，也就是借款需求越多，市场的利率越高</p>
<h3 id="cToken"><a href="#cToken" class="headerlink" title="cToken"></a>cToken</h3><p><img src="/img/image-20210320122241454.png" alt="image-20210320122241454"></p>
<p>用户在Compound存入任何币后，都会得到对应币种的cToken，比如图上的cBAT,cCOMP,cDai,cEth等 ，它是我们在Compound存款和提供流动性的凭证，账户有了cToken，就会按时收到利息，cToken也可也进行转账和交易，注意的是，cToken标的Token的兑换比例并不是1：1，总体上，借款量越高，cToken和标的资产的兑换比率越高</p>
<h3 id="抵押清算"><a href="#抵押清算" class="headerlink" title="抵押清算"></a>抵押清算</h3><p>在我们还款前，如果市场价格波动，导致抵押率达到最大抵押率，也就是清算阈值，那么第三方清算人就会介入 ，替借款人偿还全部或部分借款，得到对应价值的抵押物，并额外获得8%的抵押物激励，也就是讲抵押物的价格打了8%的折扣计价给清算人</p>
<h3 id="治理代币"><a href="#治理代币" class="headerlink" title="治理代币"></a>治理代币</h3><p>2020年2月，Compound发布了治理代币COMP,拥有COMP的用户可以参与社区投票，拥有1%以上的COMP的地址可以发起提案并开启投票</p>
<p><img src="/img/image-20210320123639722.png" alt="image-20210320123639722"></p>
<p>这是截至当前2021-03-20的投票权重，A16Z和Polychain权重最高 </p>
<p><img src="/img/image-20210320125248788.png" alt="image-20210320125248788"></p>
<p>comp的发行总量是1000万枚</p>
<p><img src="/img/image-20210320125653735.png" alt="image-20210320125653735"></p>
<p>目前的comp价格为$434</p>
<h1 id="Aave介绍"><a href="#Aave介绍" class="headerlink" title="Aave介绍"></a>Aave介绍</h1><p>Aave也是一个Defi接待平台，是一个开源的，基于以太坊的协议，用户可以将数字货币存入aave，赚取利息，也可也在Aave申请抵押借币，借币的利率可以是稳定利率Stable rate,或者是浮动利率variable rate,目前aave支持24种货币。</p>
<h2 id="创始团队-1"><a href="#创始团队-1" class="headerlink" title="创始团队"></a>创始团队</h2><p>Aave创立与2017年，总部位于伦敦项目前生叫做ETHLend，创始人是Stani Kulechov 。</p>
<p>Stanni是一个英国人，从小就热爱编程，后来大学在法学院接触了Fintech社区，之后接触了比特币和以太坊智能合约，2017年11月，ETHLend通过ICO募资了价值近1700美元的ETH，出售了10亿的LEND代币。</p>
<p>2018年9月，项目更名为Aave，Aave是芬兰语中“幽灵Ghost”的意思， 就是现在Aave的logo的幽灵的意思。</p>
<p>通过这次命名，Stani希望未来Aave未来的发展不局限于Eth，2020年1月，Aave通过了OpenZepplin的安全审计，并且主网上线。</p>
<h2 id="市场数据-1"><a href="#市场数据-1" class="headerlink" title="市场数据"></a>市场数据</h2><p><img src="/img/image-20210320132812406.png" alt="image-20210320132812406"></p>
<p><img src="/img/image-20210320133754647.png" alt="image-20210320133754647"></p>
<p>目前Aave v2的总市场规模约35亿、Aave v2的总市场规模约20亿</p>
<h2 id="利率模型-1"><a href="#利率模型-1" class="headerlink" title="利率模型"></a>利率模型</h2><p>Aave的借款利率是根据资金利用率挂钩的，他的特色</p>
<h2 id="aToken"><a href="#aToken" class="headerlink" title="aToken"></a>aToken</h2><p>aToken与对应标的token始终保持等值，比如一个aDai始终等值一个DAI，所以，由于利息的存在，通过重定向，存款用户账户的余额会实时增长。</p>
<p>它的特色是有两种可以随时切换的利率模式，稳定利率Stable rate,或者是浮动利率Variable rate</p>
<blockquote>
<p>Stable利率和Variable利率都是随着资金利用率的变化而动态变化</p>
</blockquote>
<p>借款需求越高，流动资金越少，利率就越高 </p>
<p>两种利率一的不同点是：Stable利率会实时变化、按Variable利率借款计算确认后基本上就不变了，除非满足基本的再平衡条件才会改变，如下：</p>
<ul>
<li>当前资金利用率高于95%</li>
<li>总加权平均借款利率小于25%</li>
</ul>
<p><img src="/img/image-20210320134324509.png" alt="image-20210320134324509"></p>
<h2 id="闪电贷"><a href="#闪电贷" class="headerlink" title="闪电贷"></a>闪电贷</h2><p>这是面向开发者的功能，申请人可以无抵押快速借币，但是用户需要在同一个区块中完成借款和还款，否则交易失效，以太坊虚拟机EVM的状态回滚 。</p>
<p>闪电贷的总结就是三步：借钱、用钱、连本带息还钱</p>
<p>优点：没有债务违约风险、无需抵押、不限制贷款额度</p>
<p>应用场景：套利、倒仓、抵押物交换、自清算</p>
<h2 id="治理代币-1"><a href="#治理代币-1" class="headerlink" title="治理代币"></a>治理代币</h2><p>Aave有两层治理模式，使用两种治理代币。</p>
<p>一种叫协议治理：它使用LEND代币投票，主要是决定协议中智能合约的升级，算法参数的调整等提案</p>
<p>land的总发行量是13亿，其中10亿在早期ICO中卖掉了。</p>
<p>另一种叫借贷池治理 Pool’s Governance：它使用aToken来投票，每个市场都是独立的治理投票：它主要决定一些关于借贷参数，比如抵押比率的升级调整</p>
<h2 id="Aave-V2"><a href="#Aave-V2" class="headerlink" title="Aave V2"></a>Aave V2</h2><p>Aave v2推出了很多新功能</p>
<p><strong>一、无国界金融</strong></p>
<p><strong>1、用抵押还款</strong></p>
<p>如果用户想用部分抵押品还款，他们将首先需要提取抵押品，用它来购买借入的资产，然后最终偿还债务并解锁所有已存入的抵押品，需要花费至少4个步骤。</p>
<p>而 V2 中允许用户通过在 1 笔交易中直接用抵押品付款来去除杠杆化或平仓。</p>
<p><strong>2、债务标记和信用委托</strong></p>
<p>用户的债务状况将被标记 (用户将收到代表其债务的代币)。债务的标记化使 Aave 协议中的本地信用委托成为可能，用户可以通过冷钱包进行本地头寸管理和针对特定用户的流动性挖矿策略。</p>
<p><strong>3、固定利率存款</strong></p>
<p>存款的可预测利率为流动性提供者提供明确的收入保证，不受市场变化的约束。</p>
<p><strong>4、稳定的借贷率</strong></p>
<p>为了进一步确保利率的可预测性，借款人将能够使用改良版的稳定借款利率，可以将借款利率锁定在一定的时间段内，以确保融资成本的可预测性。</p>
<p><strong>5、私募市场</strong></p>
<p>为了满足机构的需求，《 Aave协议》现在将允许政府开放私募市场以支持各种代币化资产。</p>
<p>RealT与Aave协议之间的合作正在进行中，以进一步推动DeFi并为以太坊提供抵押。</p>
<p><strong>6、优化代币</strong></p>
<p>ATokens V2集成了EIP 2612以实现无气认证，短期目标是推动采用aToken。</p>
<p><strong>7、GAS费优化</strong></p>
<p>优化 Gas 费，实现对本机 GasToke n 支持，进一步帮助用户降低交易成本。</p>
<p><strong>二、安全</strong></p>
<p><strong>8、提升协议安全性</strong></p>
<p>Aave V2建立在Aave V1安全性的强大基础上。内部设计已经简化，体系结构也得到了改进，使其更易于形式验证。</p>
<p>Aave与自动验证技术的领导者Certora和Consensys Diligence以及其他顶级审核员紧密合作，为协议及其用户带来最高的安全标准。</p>
<p><strong>三、本地交易功能</strong></p>
<p><strong>9、债务交易</strong></p>
<p>作为DeFi用户，波动的利率难以管理，Aave协议V2将为任何人提供将其债务头寸从一种资产自然地交易到另一种资产的能力。比如，你可以借贷Dai，在USDC借贷变得更便宜时，可将您的债务头寸更改为USDC，所有这些都在一次交易中完成。</p>
<p><strong>10、抵押交易</strong></p>
<p>用户可以使用Aave支持的所有货币与他们的存入资产进行交易，即使是抵押品也可以交易。</p>
<p><strong>11、保证金交易</strong></p>
<p>通过“保证金借款”，用户可以直接使用所支持的任何资产的多头和空头头寸，而无需使用第三方服务。</p>
<p>另一方面， 通过保证金贷款，流动性提供者现在能够增加其存款的比重来抓住机会。</p>
<p><strong>四、社区治理</strong></p>
<p>Aave社区是Aave协议的重心，V2引入了特定的治理功能。</p>
<p><strong>12、投票委派</strong></p>
<p>任何AAVE持有人都可以安全地将其投票权委派给任何其他地址。</p>
<p><strong>13、冷钱包投票</strong></p>
<p>分布式治理的痛苦点之一是需要将令牌从一个地方移到另一个地方以参与治理，这带来了安全性问题和用户体验的摩擦。用户现在将能够从其冷钱包签名消息以参与Aave治理</p>
<p><strong>14、将控制权分配给用户</strong></p>
<p>V2 是Aave协议“流动性挖掘”的起点，用户可以参与 V2 的讨论。</p>
<h1 id="Aave-vs-Compound"><a href="#Aave-vs-Compound" class="headerlink" title="Aave vs Compound"></a>Aave vs Compound</h1><p>Aave能否超越Compound，本文将通过比较几个重要指标来进行分析。</p>
<h2 id="代币设计"><a href="#代币设计" class="headerlink" title="代币设计"></a>代币设计</h2><p>AAVE在代币设计方面比Compound具有另一个吸引人的优势，即80％的协议费用用于购买和销毁AAVE代币。在Compound协议下，收入用于创建平台储备金，这些收入由社区管理。</p>
<p>COMP代币总供应量价值约为1.53亿美元，占Compound平台总供应量的2.2％（&#x3D; TVL +未偿还贷款总额）。</p>
<p>相比之下，Aave平台的总发行量中约有30％是其本机代币AAVE（V1中为0.43亿美元，V2中为7.36亿美元）。根据协议本身，这些仅是用户存入的作为借入稳定币的抵押品。实际上，该协议不允许用户借用其治理代币，以避免潜在的治理攻击，因为有人可能会使用借来的AAVE代币来获得额外的投票权。</p>
<h2 id="Aave和Compound用户"><a href="#Aave和Compound用户" class="headerlink" title="Aave和Compound用户"></a>Aave和Compound用户</h2><p><img src="/img/image-20210320142528869.png" alt="image-20210320142528869"></p>
<p>图片来源duneanalytics；</p>
<p>根据Dune Analytics的数据，就唯一的钱包地址数量而言，Compound的用户仍然比Aave多。</p>
<p>当然，这个度量标准也不是绝对的，因为理论上用户可以拥有多个钱包。因此，有可能人为地夸大了该度量标准，无法1：1转换为实际用户数。尽管如此，它仍然提供了有用的信息：Compound已拥有超过30万个钱包地址。明显高于Aave的4万多个地址（注意：Dune Analytics数据可能仅包括V1用户。如果包括V2用户，则这个数字可能会增加）。</p>
<h2 id="借贷额"><a href="#借贷额" class="headerlink" title="借贷额"></a>借贷额</h2><p><img src="/img/image-20210320142747477.png" alt="image-20210320142747477"></p>
<p>图片来源duneanalytics；</p>
<p>在贷款量方面，Compound也优于Aave，市场份额接近77％。 Aave的23％份额分配在其V1和V2之间。然而，Compound在整个2020年保持约80％至90％的贷款份额，因此其在2021年的表现略有下降。因此，趋势可能再次发生变化。</p>
<h2 id="协议与创新"><a href="#协议与创新" class="headerlink" title="协议与创新"></a>协议与创新</h2><p>两者在概念上都是非常相似的协议，但事实证明，Aave在实施附加服务方面更快、更具有创新性。 Aave支持20多种不同的资产，而Compound仅支持12种。Aave协议还提供稳定的利率，而Compound不提供</p>
<p>Aave引领了DeFi的发展，包括闪电贷款 和信贷委托保险库。去年12月份，Compound宣布计划推出Compound链，这是一个独立的 区块链，可在多个区块链中提供货币市场功能。</p>
<p>Aave v2发布的一系列创新功能也是一大优势</p>
<h2 id="价格表现"><a href="#价格表现" class="headerlink" title="价格表现"></a>价格表现</h2><p>2020年8月份，Aave代币当时仍未更名（前身LEND），并很快就达到了5亿美元的市值，即便如此，我们仍在怀疑AAVE是否能发展成为Compound杀手。不出半年，Aave市值增长了八倍，超过60亿美元。</p>
<p>AAVE已远远超过了COMP。今年年初，COMP的股价约为145美元左右，而AAVE的股价仅在88美元附近。截至2月初，COMP和AAVE的股价均在500美元左右。AAVE自1月初以来增长了450％以上，而COMP的增长幅度相对较小（但仍然是可观的）为240％。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>从目前的数据来看，由于Aave的快速增长，它将来在各个方面都可能取代Compound成为DeFi最受欢迎的借贷协议，这匹黑马已在许多指标上遥遥领先。它的代币设计对投资者来说也更具吸引力。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mrxccc.github.io/posts/73c3e7b2.html" data-id="cm5kxu8n300072wu41of463nx" data-title="Compound vs Aave" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Defi-新项目记录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/50d0f520.html" class="article-date">
  <time class="dt-published" datetime="2021-03-13T02:05:21.000Z" itemprop="datePublished">2021-03-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/50d0f520.html">区块链Defi新项目记录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="区块链Defi新项目记录"><a href="#区块链Defi新项目记录" class="headerlink" title="区块链Defi新项目记录"></a>区块链Defi新项目记录</h1><h2 id="Fei-protocol"><a href="#Fei-protocol" class="headerlink" title="Fei protocol"></a>Fei protocol</h2><p>Fei Protocol 支持创建基于以太坊的去中心化、可扩展且公平的稳定币，它的取名灵感来自于雅浦岛上著名的石头货币（FEI）——希望 FEI 表现出与石头货币相同的稳定性、简单性和普适性。</p>
<p>FEI 采用了一种「直接激励」的新型稳定实现机制，它资本效率更高、分配公平、而且完全去中心化，该协议使用协议控制的资产价值（PCV，新概念，下文详细讲到）来维持二级市场的流动性，实现 FEI 的挂钩发行与价值稳定。</p>
<p>Fei Protocol 设计了协议控制的资产价值 （PCV） 模型来解决TVL通胀问题</p>
<h3 id="Fei-Protocol-如何运作"><a href="#Fei-Protocol-如何运作" class="headerlink" title="Fei Protocol 如何运作"></a>Fei Protocol 如何运作</h3><p>与 TVL 下的 IOU 不同，PCV 中资用户不可以随时撤走存入的资产，当然 PCV 中的治理代币可积累更深层次的价值捕获并承担相应的责任，而 Fei Protocol 就是 PCV 的理想应用</p>
<p>联合曲线和其他激励措施为 PCV 池提供资金，该池大约等于 FEI 的整个用户流通量，它将由 ETH 联合曲线资助的 100%PCV 分配给以 ETH &#x2F; FEI 的 Uniswap 池（将来不排除将 PCV 重新分配给其他平台）</p>
<h3 id="激励措施"><a href="#激励措施" class="headerlink" title="激励措施"></a>激励措施</h3><p>FEI 采用了一种「直接激励」的新稳定实现机制：直接激励是指激励稳定币交易活动和激励稳定币使用的行为，奖励和惩罚将价格推向锚定目标。通常这将包括至少一个作为枢纽的激励性交易所，所有其他交易所和二级市场都可以通过激励性交易所进行套利，这有助于稳定币在整个生态系统中维持挂钩</p>
<p><img src="/img/fei.png"></p>
<p>在创世阶段，购买Fei的价格会以一定的折扣进行奖励，同时Fei的价格也在提升，一直到$1维持不变，所有早期的PCV储备就是这样来的</p>
<h3 id="治理代币"><a href="#治理代币" class="headerlink" title="治理代币"></a>治理代币</h3><p>Fei Protocol 将在一开始就以完全去中心化的 DAO 启动，而 TRIBE 代币就是 DAO 的治理凭证</p>
<p>Genesis Group（最开始创世阶段买入Fei的群体） 的完成将启动 TRIBE 代币的初始发售，Uniswap 上将有 FEI 和 TRIBE 同时发行，TRIBE 完全稀释后的估值将设置为与 Genesis Group 筹集的 ETH 数量相同值。且代币将存储在发展基金中，它将在四年内进行线性解锁，以保证足够的流动性。</p>
<h2 id="Float-protocol"><a href="#Float-protocol" class="headerlink" title="Float protocol"></a>Float protocol</h2><p>官网：<a target="_blank" rel="noopener" href="https://floatprotocol.com/">https://floatprotocol.com/</a><br>推特：<a target="_blank" rel="noopener" href="https://twitter.com/FloatProtocol">https://twitter.com/FloatProtocol</a><br>电报：<a target="_blank" rel="noopener" href="https://t.me/officialfloatprotocol">https://t.me/officialfloatprotocol</a><br>官方doc：<a target="_blank" rel="noopener" href="https://docs-float.gitbook.io/docs/">https://docs-float.gitbook.io/docs/</a></p>
<p>项目解读：（来自金色财经：<a target="_blank" rel="noopener" href="https://www.jinse.com/blockchain/1022681.html%EF%BC%89">https://www.jinse.com/blockchain/1022681.html）</a></p>
<p>float定义自己是一个基于web3的浮动、低波动性货币(Floating, Low-volatility Currency for Web3)，团队为匿名团队。</p>
<p>项目中有两个代币，float和bank，其中：</p>
<p>float是“稳定币”，但团队声称， float并不锚定1美元，而是浮动的，“它像大多数主要的法定货币一样，旨在随时间浮动和改变价值”。初始的目标价格为1.618美元，目标价格会随时市场情况而变化。</p>
<p>bank承担着float价值稳定(包括通胀时降低float价值和通缩时提振float价值)以及治理的功能</p>
<h3 id="稳定机制"><a href="#稳定机制" class="headerlink" title="稳定机制"></a>稳定机制</h3><p>每24小时，系统会触发rebase，通过rebase来重新稳定float价格，rebase的过程，是用户支付ETH（v1，v2中计划引入其他资产，但是v1仅有eth，下文中都以eth代替）和BANK来向协议获得新的FLOAT(通胀时)，或协议使用ETH和BANK来回购FLOAT(通缩时)</p>
<p>如果FLOAT的价格偏离其目标价格：</p>
<p>通胀时，系统通过铸造FLOAT来改变供应量进而影响价格，具体实现形式为荷兰式拍卖(套利者有机会以低于市场价格的价格购买新的FLOAT)，系统受到的BANK会被销毁，ETH会进入金库<br>通缩时，系统通过购买并燃烧FLOAT来改版供应链进而影响价格， 具体实现形式为反向荷兰式拍卖(套利者有机会以高于市场价格的价格出售FLOAT)，同时销毁回购的FLOAT<br>这样，通过套利者来改变市场上的供应，进而达到稳定。</p>
<h3 id="VAULT-金库"><a href="#VAULT-金库" class="headerlink" title="VAULT(金库)"></a>VAULT(金库)</h3><p>在float的机制中，金库(vault)里锁定了ETH（或v2中计划引入的其他基础“抵押物”）。在初始阶段，合约中的这部分ETH并不会用来做其他事情，只是等待在通缩阶段回购FLOAT（不代表之后不会），金库是在通缩阶段能将FLOAT拉回目标价的关键储备。</p>
<h3 id="VAULT-FACTOR-金库充足率"><a href="#VAULT-FACTOR-金库充足率" class="headerlink" title="VAULT FACTOR(金库充足率)"></a>VAULT FACTOR(金库充足率)</h3><p>VAULT FACTOR &#x3D; 金库中锁定的ETH市值 &#x2F; 流通中的FLOAT目标价格市值。</p>
<p>以下表格介绍了在通胀阶段和通缩阶段两种情形下，叠加金库充足率本身出于盈余或不足状态时，发生拍卖时BANK价值和VAULT FACTOR的变化：</p>
<p>假设当前vault factor 为 a ，则a-1&gt;0时，vault factor为盈余状态，反之为不足状态</p>
<p><img src="/img/float.jpg"></p>
<h3 id="治理代币-1"><a href="#治理代币-1" class="headerlink" title="治理代币"></a>治理代币</h3><p>分发的具体信息如下：</p>
<p>第1年总共会铸造168,000 BANK。预期分配如下：</p>
<p>社区分发：50％,其中阶段1分配37.5％，阶段2分配12.5％</p>
<p>团队令牌：5％（在初次铸币仪式结束后分发，并锁定12个月）。</p>
<p>财政部(treasury)：10％（在社区分发第二阶段开始时铸造，并由DAO控制）。</p>
<p>发行后的流动性激励措施：35％（5％的初始流通量铸币，30％由DAO控制，目标是进行各种流动性激励措施和合伙关系）。</p>
<p>1年后，BANK可能会有通胀，届时会由DAO来控制。</p>
<p>第1阶段（从2月7日星期日22:00 UTC开始，持续6周,至3月21日结束）</p>
<p>项目采取白名单制，目前白名单由参与Snapshot.page上任何协议的链下治理和&#x2F;或Compound，MakerDao或MolochDao上链上治理的地址的代表，Yearn、UMA的、YAM、Curve的delegates，具体是否在白名单可以通过官网链接钱包后查看。</p>
<p>在白名单内的用户可以使用USDT、DAI、USDC进行挖矿，每天将分配1,500.00 BANK，或每个池500 BANK。总共每周将分发10,500 BANK，6周一共63,000BANK。</p>
<p>每个池中最多可以存入10,000个token，即单个白名单地址的投入上限是3万U，目前TVL并不高，还不到3500万U，按照目前BANK的$266的价格，日化收益率在1.15%左右</p>
<p>第2阶段（从3月21日星期日22:00 UTC开始，持续2周）</p>
<p>第二阶段旨在向顶级DeFI协议社区提供广泛的分发，并实现BANK令牌的初始价格发现。</p>
<p>相对第一阶段，将不再有白名单的限制。此外，将添加新的非稳定币池，每天总计分发1500BANK(所有池子)</p>
<p>完整的公告将在第2阶段开始前1周(即3月14日)提供。</p>
<p>此外，在第2阶段，系统还将激励BANK-ETH的流动资金池，以便更好地发现价格。</p>
<h3 id="可能存在的风险"><a href="#可能存在的风险" class="headerlink" title="可能存在的风险"></a>可能存在的风险</h3><p>合约目前未经审计（虽然1阶段的合约是snx的fork，且出问题的可能性不大）；</p>
<p>合约内存在较多复杂的交互及组合，复杂性带来更多危险的可能性；</p>
<p>VAULT内锁定的ETH丢失风险；</p>
<p>项目未能如期上线的风险。</p>
<h2 id="Bigdata-protocol"><a href="#Bigdata-protocol" class="headerlink" title="Bigdata protocol"></a>Bigdata protocol</h2><h3 id="项目信息："><a href="#项目信息：" class="headerlink" title="项目信息："></a>项目信息：</h3><p>主页：<a target="_blank" rel="noopener" href="https://bigdataprotocol.com/">https://bigdataprotocol.com/</a><br>所在链：Ethereum<br>平台币：BDP<br>上线日期：2021&#x2F;3&#x2F;04</p>
<h3 id="项目解读："><a href="#项目解读：" class="headerlink" title="项目解读："></a>项目解读：</h3><p>区块链世界里，可以分为三种需求：刚性需求（比如借贷、交易、流动性挖矿）+弱需求（比如defi里面的指数产品）+伪需求（没有应用场景）。</p>
<p>1.做的是大数据。在区块链领域，能不能算是大的需求？</p>
<p>大数据在区块链里面，介于弱需求和伪需求之间，价值有待验证。</p>
<p>2.代币模型</p>
<p>BDP（8000万枚）相当于平台币，BALPHA（18000枚）（暂叫数据管理币）可能会去消耗它。代币分配见官网。</p>
<p>bigdata主要想让</p>
<p>3.Bigdata最初成为神矿，之所以叫“神矿”，是因为一上线锁仓量就冲到几十亿美金。在其流动性矿池staking的币，发现有OCEAN、SRM、TOMOE。这些小币种，几乎都不了解它。这种项目，上了一些很冷门的大多数人不知道的币，这里面就可能有问题。可能会出现，项目方手里有这些小币种，在项目里去流动性挖矿。如果大家都不买这些币或者很少的人抵押这些币，那么你就可以挖到很多币。如果大家都去买这些币的话，那么你就可以高价套现，这是套路的一种方式，注意风险。</p>
<p>4.bigdata早期价格US$14.93，截止目前US$3.73，跌了将近4-5倍，早期进场的人，心里是有一个价值预期的，未来会烧掉挖出来的币bAlpha，所以对它未来的通缩有一定的心理期望，但是这种期望是无法长期维系的，一旦有很长的下跌周期，很多人是拿不住的，会跌的比较快。但后面能否救得活，还有是有一定可能，该协议在上线初期，就已被爆出 SBF、神鱼、Cream.Finance 和 SWAG.Finance 创始人黄立成等都参与了该协议的挖矿，资本的介入，也是因为大户的介入，才使得它的热度和tvl才这么高</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mrxccc.github.io/posts/50d0f520.html" data-id="cm5kxu8nd000b2wu45zxg2567" data-title="区块链Defi新项目记录" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-搭建一个以太坊投票dapp的Demo，感受区块链的魅力" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/78ae6864.html" class="article-date">
  <time class="dt-published" datetime="2021-01-29T07:32:12.000Z" itemprop="datePublished">2021-01-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/78ae6864.html">Ganache搭建一个以太坊投票dapp的Demo</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="工具及技术框架"><a href="#工具及技术框架" class="headerlink" title="工具及技术框架"></a>工具及技术框架</h2><ul>
<li><p>智能合约编写工具：Remix，个人喜欢用remix写智能合约，写好智能合约直接部署测试，把写好的合约代码再放到拷贝出来放到项目中进行编译</p>
</li>
<li><p>前端页面编写工具：vscode</p>
</li>
<li><p>环境：node：v14.17.0、npm：6.14.13</p>
</li>
<li><p>依赖包：<code>&quot;ganache-cli&quot;: &quot;^6.12.2&quot;, &quot;solc&quot;: &quot;^0.4.22&quot;,&quot;web3&quot;: &quot;^1.3.6&quot;</code></p>
<p>关于几个依赖包的简要介绍：</p>
</li>
</ul>
<p><strong>Ganache CLI</strong></p>
<p>Ganache CLI是以太坊开发工具Truffle套件的一部分，是以太坊开发私有区块链的Ganache命令行版本，用于测试和开发的快速以太坊RPC客户端，用于测试和开发的快速以太坊RPC客户端。ganache-cli是用Javascript编写的，并通过npm作为Node包进行分发。安装之前首先要确保安装了Node.js（&gt; &#x3D; v6.11.5）。</p>
<blockquote>
<p>旨在快速搭建一个小demo，就没有用geth客户端去搭建一个本地私有链，直接用Ganache建一个干净纯粹的模拟节点进行测试，跟在Remix上用JavaScript VM测试合约是一个原理</p>
</blockquote>
<p><strong>solc</strong></p>
<p>solidity编写的以太坊智能合约可通过命令行编译工具solc来进行编译，成为以太坊虚拟机中的代码。solc编译后最终部署到链上形成我们所见到的各种智能合约。</p>
<p><strong>web3</strong></p>
<p>web3.js是一个库集合，你可以使用HTTP或IPC连接本地或远程以太它节点进行交互。 web3的JavaScript库能够与以太坊区块链交互。 它可以检索用户帐户，发送交易，与智能合约交互等。</p>
<p>以上的三个依赖包具体的信息就不详细介绍</p>
<h2 id="工程结构"><a href="#工程结构" class="headerlink" title="工程结构"></a>工程结构</h2><p>首先使用<code>node init</code>初始化一个node项目，这里取名字为<code>simple_voting_dapp</code></p>
<p>项目根目录安装依赖：npm i <a href="mailto:&#x67;&#x61;&#110;&#97;&#99;&#104;&#101;&#x2d;&#99;&#x6c;&#x69;&#64;&#x36;&#x2e;&#x31;&#50;&#x2e;&#50;">&#x67;&#x61;&#110;&#97;&#99;&#104;&#101;&#x2d;&#99;&#x6c;&#x69;&#64;&#x36;&#x2e;&#x31;&#50;&#x2e;&#50;</a> <a href="mailto:&#x73;&#111;&#108;&#99;&#x40;&#x30;&#x2e;&#x34;&#x2e;&#x32;&#50;">&#x73;&#111;&#108;&#99;&#x40;&#x30;&#x2e;&#x34;&#x2e;&#x32;&#50;</a> <a href="mailto:&#119;&#101;&#98;&#51;&#64;&#49;&#x2e;&#x33;&#46;&#54;">&#119;&#101;&#98;&#51;&#64;&#49;&#x2e;&#x33;&#46;&#54;</a></p>
<p>安装完成后package.json应该是如下信息</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;simple_voting_dapp&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;ganache-cli&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.12.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;solc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.4.22&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;web3&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.3.6&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>接着创建如下目录结构及代码</p>
<p><img src="/img/image-20210629174325035.png" alt="image-20210629174325035"></p>
<h2 id="投票合约"><a href="#投票合约" class="headerlink" title="投票合约"></a>投票合约</h2><p>本例子中的投票合约是一个非常简单的合约，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.22;</span><br><span class="line"></span><br><span class="line">contract Voting &#123;</span><br><span class="line">    bytes32[] public canditateList;</span><br><span class="line">    mapping (bytes32 =&gt; uint8) public votesReceived;</span><br><span class="line">    constructor() public &#123;</span><br><span class="line">        canditateList = getBytes32ArrayForInput();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function validateCandidate(bytes32 candiateName) internal view returns(bool)&#123;</span><br><span class="line">        for(uint8 i = 0;i&lt;canditateList.length; i++)&#123;</span><br><span class="line">            if(candiateName == canditateList[i])</span><br><span class="line">                return true;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    function vote(bytes32 candiateListName) public payable returns(bytes32)&#123;</span><br><span class="line">        require(validateCandidate(candiateListName));</span><br><span class="line">        votesReceived[candiateListName] +=1;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function totalVotesFor(bytes32 candiateName) public view returns(uint8)&#123;</span><br><span class="line">        require(validateCandidate(candiateName));</span><br><span class="line">        return votesReceived[candiateName];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function getBytes32ArrayForInput() pure public returns (bytes32[3] b32Arr) &#123;</span><br><span class="line">        b32Arr = [bytes32(&quot;Candidate&quot;), bytes32(&quot;Alice&quot;), bytes32(&quot;Cary&quot;)];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>变量说明</strong>：</p>
<p>canditateList：投票的对象</p>
<p>votesReceived：投票的对象—&gt;获得的总票数。一个映射</p>
<p><strong>构造函数</strong>：</p>
<p>调用getBytes32ArrayForInput函数初始化三个投票对象至canditateList中</p>
<p><strong>函数</strong></p>
<p>validateCandidate：一个internal、view的函数，返回目标是否在投票对象列表中</p>
<p>vote：给制定投票对象进行投票</p>
<p>totalVotesFor：查看指定对象的获得票数</p>
<h2 id="编译脚本compile-js"><a href="#编译脚本compile-js" class="headerlink" title="编译脚本compile.js"></a>编译脚本compile.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs-extra&#x27;</span>); </span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>); </span><br><span class="line"><span class="keyword">const</span> solc = <span class="built_in">require</span>(<span class="string">&#x27;solc&#x27;</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// cleanup 清除之前已编译的文件</span></span><br><span class="line"><span class="keyword">const</span> compiledDir = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../compiled&#x27;</span>);</span><br><span class="line">fs.<span class="title function_">removeSync</span>(compiledDir); </span><br><span class="line">fs.<span class="title function_">ensureDirSync</span>(compiledDir);</span><br><span class="line"><span class="comment">// compile 开始编译合约</span></span><br><span class="line"><span class="keyword">const</span> contractPath = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../../contract&#x27;</span>, </span><br><span class="line"><span class="string">&#x27;voting.sol&#x27;</span>); </span><br><span class="line"><span class="keyword">const</span> contractSource = fs.<span class="title function_">readFileSync</span>(contractPath, <span class="string">&#x27;utf8&#x27;</span>); </span><br><span class="line"><span class="keyword">const</span> result = solc.<span class="title function_">compile</span>(contractSource, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// check errors 检查错误</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(result.<span class="property">errors</span>) &amp;&amp; result.<span class="property">errors</span>.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(result.<span class="property">errors</span>[<span class="number">0</span>]); </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// save to disk 保存到指定目录compiled目录中</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(result.<span class="property">contracts</span>).<span class="title function_">forEach</span>( <span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> contractName = name.<span class="title function_">replace</span>(<span class="regexp">/^:/</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> filePath = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../compiled&#x27;</span>, </span><br><span class="line">    <span class="string">`<span class="subst">$&#123;contractName&#125;</span>.json`</span>);</span><br><span class="line">    fs.<span class="title function_">outputJsonSync</span>(filePath, result.<span class="property">contracts</span>[name]);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`save compiled contract <span class="subst">$&#123;contractName&#125;</span> to </span></span><br><span class="line"><span class="string">    <span class="subst">$&#123;filePath&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>部署脚本deploy.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Web3</span> = <span class="built_in">require</span>(<span class="string">&#x27;web3&#x27;</span>);</span><br><span class="line"><span class="comment">// 连接到ganache启动的节点</span></span><br><span class="line"><span class="keyword">const</span> web3 = <span class="keyword">new</span> <span class="title class_">Web3</span>(<span class="keyword">new</span> <span class="title class_">Web3</span>.<span class="property">providers</span>.<span class="title class_">HttpProvider</span>(<span class="string">&#x27;http://localhost:8545&#x27;</span>));</span><br><span class="line"><span class="comment">// 1. 拿到 abi 和 bytecode </span></span><br><span class="line"><span class="keyword">const</span> contractPath = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../compiled/Voting.json&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; interface, bytecode &#125; = <span class="built_in">require</span>(contractPath);</span><br><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 2. 获取钱包里面的账户</span></span><br><span class="line">    <span class="keyword">const</span> accounts = <span class="keyword">await</span> web3.<span class="property">eth</span>.<span class="title function_">getAccounts</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;部署合约的账户：&#x27;</span>, accounts[<span class="number">0</span>]);</span><br><span class="line">    <span class="comment">// 3. 创建合约实例并且部署</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">time</span>(<span class="string">&#x27;合约部署耗时&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> <span class="keyword">new</span></span><br><span class="line">        web3.<span class="property">eth</span>.<span class="title class_">Contract</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(interface))</span><br><span class="line">        .<span class="title function_">deploy</span>(&#123;<span class="attr">data</span>: bytecode&#125;)</span><br><span class="line">        .<span class="title function_">send</span>(&#123;</span><br><span class="line">            <span class="attr">from</span>: accounts[<span class="number">0</span>],</span><br><span class="line">            <span class="attr">gas</span>: <span class="number">1500000</span>,</span><br><span class="line">            <span class="attr">gasPrice</span>: <span class="string">&#x27;30000000000000&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">newContractInstance</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;合约部署成功: &#x27;</span> + newContractInstance.<span class="property">options</span>.<span class="property">address</span>) <span class="comment">// instance with the new contract address</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">timeEnd</span>(<span class="string">&#x27;合约部署耗时&#x27;</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h2 id="部署合约"><a href="#部署合约" class="headerlink" title="部署合约"></a>部署合约</h2><p>1.手动启动ganache程序，运行一个节点，保持终端不关闭</p>
<blockquote>
<p><code>.\node_modules\.bin\ganache-cli</code></p>
</blockquote>
<p>2.编译voting.sol投票合约</p>
<blockquote>
<p><code>node .\contract_workflow\scripts\compile.js</code></p>
</blockquote>
<p>contract_workflow目录下面会出现Voting.json文件，后面index.js会用到该文件中的内容</p>
<p>3.部署合约</p>
<blockquote>
<p><code>node .\contract_workflow\scripts\deploy.js</code></p>
</blockquote>
<p>会出现以下信息</p>
<blockquote>
<p>部署合约的账户： 0x8C6ba0616f05909eCb334C1a3707C38a8d7bDd0F</p>
<p>合约部署成功: 0xaCCBC818BC9224A6da2902eeF82c3d14afC82aB5</p>
<p>合约部署耗时: 345.211ms</p>
</blockquote>
<h2 id="网页交互代码index-html"><a href="#网页交互代码index-html" class="headerlink" title="网页交互代码index.html"></a>网页交互代码index.html</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Voting DApp<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&#x27;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css&#x27;</span> <span class="attr">rel</span>=<span class="string">&#x27;stylesheet&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;text/css&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>A Simple Voting Application<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-responsive&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table table-bordered&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>Candidate<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>Votes<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Candidate<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">&quot;candidate-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Alice<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">&quot;candidate-2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cary<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">&quot;candidate-3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;candidate&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;vote()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span>Vote<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://code.jquery.com/jquery-3.1.1.slim.min.js&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="网页交互index-js"><a href="#网页交互index-js" class="headerlink" title="网页交互index.js"></a>网页交互index.js</h2><p>要注意<code>contractAddr</code>和<code>abi</code>两个变量的值，</p>
<p>contractAddr是在部署合约时获取的</p>
<p>abi是从Voting.json中的interface获取的，打开Voting.json即可看到interface对象内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const path = require(&#x27;path&#x27;);</span></span><br><span class="line"><span class="keyword">const</span> web3 = <span class="keyword">new</span> <span class="title class_">Web3</span>(<span class="keyword">new</span> <span class="title class_">Web3</span>.<span class="property">providers</span>.<span class="title class_">HttpProvider</span>(<span class="string">&quot;http://localhost:8545&quot;</span>));</span><br><span class="line"><span class="comment">// const contractPath = path.resolve(__dirname, &#x27;../contract_workflow/compiled/Voting.json&#x27;);</span></span><br><span class="line"><span class="comment">// 部署的只能合约地址</span></span><br><span class="line">contractAddr = <span class="string">&quot;0xaCCBC818BC9224A6da2902eeF82c3d14afC82aB5&quot;</span>;</span><br><span class="line"><span class="comment">// abi内容，从Voting.json中拷贝interface对象的内容，由于内容过程，这里就省略了</span></span><br><span class="line">abi = <span class="string">&quot;&quot;</span></span><br><span class="line">contractInstance = <span class="keyword">new</span> web3.<span class="property">eth</span>.<span class="title class_">Contract</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(abi),contractAddr);</span><br><span class="line">candidates = &#123; <span class="string">&quot;Candidate&quot;</span>: <span class="string">&quot;candidate-1&quot;</span>, <span class="string">&quot;Alice&quot;</span>: <span class="string">&quot;candidate-2&quot;</span>, <span class="string">&quot;Cary&quot;</span>: <span class="string">&quot;candidate-3&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> accounts;</span><br><span class="line">web3.<span class="property">eth</span>.<span class="title function_">getAccounts</span>().<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> accounts = result);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">vote</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> candidateName = $(<span class="string">&quot;#candidate&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        contractInstance.<span class="property">methods</span>.<span class="title function_">vote</span>(<span class="title function_">stringtoHex</span>(candidateName)).<span class="title function_">send</span>(&#123;<span class="attr">from</span>: accounts[<span class="number">0</span>] &#125;)</span><br><span class="line">        .<span class="title function_">on</span>(<span class="string">&#x27;transactionHash&#x27;</span>, <span class="keyword">function</span>(<span class="params">hash</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hash:&quot;</span> + hash)</span><br><span class="line">            contractInstance.<span class="property">methods</span>.<span class="title function_">totalVotesFor</span>(<span class="title function_">stringtoHex</span>(candidateName)).<span class="title function_">call</span>().<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> $(<span class="string">&quot;#&quot;</span> + candidates[candidateName]).<span class="title function_">html</span>(result));</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">on</span>(<span class="string">&#x27;confirmation&#x27;</span>, <span class="keyword">function</span>(<span class="params">confirmationNumber, receipt</span>)&#123;</span><br><span class="line">            <span class="comment">// console.log(confirmationNumber,receipt)</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">on</span>(<span class="string">&#x27;receipt&#x27;</span>, <span class="keyword">function</span>(<span class="params">receipt</span>)&#123;</span><br><span class="line">            <span class="comment">// receipt example</span></span><br><span class="line">            <span class="comment">// console.log(&quot;receipt&quot; +receipt);</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="variable language_">console</span>.<span class="property">error</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">     &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// 需转成16进制的才能给合约中byte32的数据传参，且前缀要加上0x</span></span><br><span class="line"><span class="keyword">var</span> stringtoHex = <span class="keyword">function</span> (<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> val = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (val == <span class="string">&quot;&quot;</span>)</span><br><span class="line">            val = str.<span class="title function_">charCodeAt</span>(i).<span class="title function_">toString</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            val += str.<span class="title function_">charCodeAt</span>(i).<span class="title function_">toString</span>(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;0x&quot;</span>+val</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    candidateNames = <span class="title class_">Object</span>.<span class="title function_">keys</span>(candidates);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; candidateNames.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> name = candidateNames[i];</span><br><span class="line">        contractInstance.<span class="property">methods</span>.<span class="title function_">totalVotesFor</span>(<span class="title function_">stringtoHex</span>(name)).<span class="title function_">call</span>().<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> $(<span class="string">&quot;#&quot;</span> + candidates[name]).<span class="title function_">html</span>(result));</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在本地打开src&#x2F;index.html，出现以下界面</p>
<p><img src="/img/voting2.png" alt="image-20210629174325035"></p>
<p>在输入框中输入对应投票对象的名字，点击<code>Vote</code>按钮即可为指定对象增加票数</p>
<p>至此，一个完整的demo就完成了！！</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本项目是一个比较基础的区块链demo，但是还有很多要优化的地方</p>
<ul>
<li>基于ganache启动的节点在关闭后，需要重新部署合约</li>
<li>部署合约编译部署分为了两步，很繁琐</li>
<li>部署合约后要手动修改index.js中合约地址和abi</li>
</ul>
<p>所以自动化的流程还是比较繁琐的</p>
<p>但是通过这个小demo，可以学到的东西还是很多的，比如如何用node通过ganache启动一个本地私有节点、如何编译合约、部署合约、调用合约</p>
<p>后期会介绍一个更自动化、更简便的框架Truffle去实现以上步骤，通过Truffle框架把以上很多编译，部署的脚本都帮我们完成了，所以学了这个demo后，学习truffle会更加得心应手</p>
<h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><p>感谢尚硅谷的区块链教程：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1NJ411D7rf">https://www.bilibili.com/video/BV1NJ411D7rf</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mrxccc.github.io/posts/78ae6864.html" data-id="cm5kxu8ox003b2wu41tkl430c" data-title="Ganache搭建一个以太坊投票dapp的Demo" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">区块链</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Java8新特性-新时间与日期API" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/c2accabf.html" class="article-date">
  <time class="dt-published" datetime="2020-12-10T02:52:02.000Z" itemprop="datePublished">2020-12-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java8%E6%96%B0%E7%89%B9%E6%80%A7/">Java8新特性</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/c2accabf.html">Java8新特性-新时间与日期API</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>总结一下java8中的新特性<code>新时间与日期API</code></p>
<p><code>LocalDate、LocalTime、LocalDateTime </code>类的实 例是不可变的对象，分别表示使用 ISO-8601日 历系统的日期、时间、日期和时间。它们提供了简单的日期或时间，并不包含当前的时间息。也不包含与时区相关的信息。</p>
<h2 id="LocalDateTime常用方法"><a href="#LocalDateTime常用方法" class="headerlink" title="LocalDateTime常用方法"></a>LocalDateTime常用方法</h2><p><code>LocalDate / LocalTime</code>用法类似，只不过<code>LocalDate </code>包含<code>年月日</code>，<code>LocalTime</code>只包含<code>时分秒</code></p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>返回值类型</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>now( )</td>
<td>static LocalDateTime</td>
<td>从默认时区的系统时钟获取当前日期</td>
</tr>
<tr>
<td>of(int year, int month, int dayOfMonth, int hour, int minute, int second)</td>
<td>static LocalDateTime</td>
<td>从年，月，日，小时，分钟和秒获得 LocalDateTime的实例，将纳秒设置为零</td>
</tr>
<tr>
<td>plus(long amountToAdd, TemporalUnit unit)</td>
<td>LocalDateTime</td>
<td>返回此日期时间的副本，并添加指定的数量</td>
</tr>
<tr>
<td>get(TemporalField field)</td>
<td>int</td>
<td>从此日期时间获取指定字段的值为 int</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">ldt</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">    System.out.println(ldt);<span class="comment">// 2020-12-10T11:48:43.387</span></span><br><span class="line"></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">ld2</span> <span class="operator">=</span> LocalDateTime.of(<span class="number">2020</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">10</span>);</span><br><span class="line">    System.out.println(ld2);<span class="comment">// 2020-12-10T11:11:10</span></span><br><span class="line"></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">ldt3</span> <span class="operator">=</span> ld2.plusYears(<span class="number">20</span>);</span><br><span class="line">    System.out.println(ldt3);<span class="comment">// 2040-12-10T11:11:10</span></span><br><span class="line"></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">ldt4</span> <span class="operator">=</span> ld2.minusMonths(<span class="number">2</span>);</span><br><span class="line">    System.out.println(ldt4);<span class="comment">// 2020-10-10T11:11:10</span></span><br><span class="line"></span><br><span class="line">    System.out.println(ldt.getYear());<span class="comment">// 2020</span></span><br><span class="line">    System.out.println(ldt.getMonthValue());<span class="comment">// 12</span></span><br><span class="line">    System.out.println(ldt.getDayOfMonth());<span class="comment">// 10</span></span><br><span class="line">    System.out.println(ldt.getHour());<span class="comment">// 11</span></span><br><span class="line">    System.out.println(ldt.getMinute());<span class="comment">// 48</span></span><br><span class="line">    System.out.println(ldt.getSecond());<span class="comment">// 43</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="时间戳Instant"><a href="#时间戳Instant" class="headerlink" title="时间戳Instant"></a>时间戳Instant</h2><p>Instant：用于“时间戳”的运算。它是以Unix元年(传统 的设定为UTC时区1970年1月1日午夜时分)开始 所经历的描述进行运算，也就是UTC时间或者GMT格林威治时间</p>
<p>GMT&#x3D;UTC<br>UTC+8&#x3D;北京时间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2. Instant : 时间戳。 （使用 Unix 元年  1970年1月1日 00:00:00 所经历的毫秒值）</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Instant</span> <span class="variable">ins</span> <span class="operator">=</span> Instant.now();  <span class="comment">//默认使用 UTC 时区</span></span><br><span class="line">    System.out.println(ins);<span class="comment">// 2020-12-10T03:50:25.814Z</span></span><br><span class="line"></span><br><span class="line">    <span class="type">OffsetDateTime</span> <span class="variable">odt</span> <span class="operator">=</span> ins.atOffset(ZoneOffset.ofHours(<span class="number">8</span>));</span><br><span class="line">    System.out.println(odt);<span class="comment">// 2020-12-10T11:50:25.814+08:00</span></span><br><span class="line"></span><br><span class="line">    System.out.println(ins.getNano());<span class="comment">// 814000000</span></span><br><span class="line"></span><br><span class="line">    <span class="type">Instant</span> <span class="variable">ins2</span> <span class="operator">=</span> Instant.ofEpochSecond(<span class="number">5</span>);</span><br><span class="line">    System.out.println(ins2);<span class="comment">// 1970-01-01T00:00:05Z</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="时间-日期-差"><a href="#时间-日期-差" class="headerlink" title="时间 &#x2F; 日期 差"></a>时间 &#x2F; 日期 差</h2><ul>
<li>Duration：计算两个时间之间的间隔</li>
<li>Period：计算两个日期之间的间隔</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Duration : 用于计算两个“时间”间隔</span></span><br><span class="line"><span class="comment">//Period : 用于计算两个“日期”间隔</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Instant</span> <span class="variable">ins1</span> <span class="operator">=</span> Instant.now();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;--------------------&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Instant</span> <span class="variable">ins2</span> <span class="operator">=</span> Instant.now();</span><br><span class="line">    <span class="comment">// 获取两个时间间隔</span></span><br><span class="line">    <span class="type">Duration</span> <span class="variable">duration</span> <span class="operator">=</span> Duration.between(ins1, ins2);</span><br><span class="line">    System.out.println(<span class="string">&quot;所耗费时间为(单位毫秒)：&quot;</span> + duration.toMillis());<span class="comment">// 所耗费时间为(单位秒)：1001</span></span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;----------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">LocalDate</span> <span class="variable">ld1</span> <span class="operator">=</span> LocalDate.now();</span><br><span class="line">    System.out.println(<span class="string">&quot;现在日期为：&quot;</span>+ ld1);<span class="comment">// 现在日期为：2020-12-10</span></span><br><span class="line">    <span class="type">LocalDate</span> <span class="variable">ld2</span> <span class="operator">=</span> LocalDate.of(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 获取两个日期间隔</span></span><br><span class="line">    <span class="type">Period</span> <span class="variable">pe</span> <span class="operator">=</span> Period.between(ld2, ld1);</span><br><span class="line">    System.out.println(<span class="string">&quot;年间隔&quot;</span> + pe.getYears());<span class="comment">// 9</span></span><br><span class="line">    System.out.println(<span class="string">&quot;月间隔&quot;</span> + pe.getMonths());<span class="comment">// 11</span></span><br><span class="line">    System.out.println(<span class="string">&quot;天间隔&quot;</span> + pe.getDays());<span class="comment">// 9</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="时间校正器"><a href="#时间校正器" class="headerlink" title="时间校正器"></a>时间校正器</h2><ul>
<li>TemporalAdjuster : 时间校正器。有时我们可能需要获 取例如：将日期调整到“下个周日”等操作。</li>
<li>TemporalAdjusters : 该类通过静态方法提供了大量的常 用 TemporalAdjuster 的实现。</li>
</ul>
<p>TemporalAdjuster是一个函数接口，因此还可也用lambda表达式实现里面的接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TemporalAdjuster</span> &#123;</span><br><span class="line"></span><br><span class="line">    Temporal <span class="title function_">adjustInto</span><span class="params">(Temporal temporal)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 当前日期</span></span><br><span class="line">	<span class="type">LocalDateTime</span> <span class="variable">ldt</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">	System.out.println(ldt);</span><br><span class="line">    <span class="comment">// 本月第12天</span></span><br><span class="line">	<span class="type">LocalDateTime</span> <span class="variable">ldt2</span> <span class="operator">=</span> ldt.withDayOfMonth(<span class="number">12</span>);</span><br><span class="line">	System.out.println(ldt2);</span><br><span class="line">	<span class="comment">// 下一个周日</span></span><br><span class="line">	<span class="type">LocalDateTime</span> <span class="variable">ldt3</span> <span class="operator">=</span> ldt.with(TemporalAdjusters.next(DayOfWeek.SUNDAY));</span><br><span class="line">	System.out.println(ldt3);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//自定义：下一个工作日</span></span><br><span class="line">	<span class="type">LocalDateTime</span> <span class="variable">ldt5</span> <span class="operator">=</span> ldt.with((l) -&gt; &#123;</span><br><span class="line">		<span class="type">LocalDateTime</span> <span class="variable">ldt4</span> <span class="operator">=</span> (LocalDateTime) l;</span><br><span class="line">		</span><br><span class="line">		<span class="type">DayOfWeek</span> <span class="variable">dow</span> <span class="operator">=</span> ldt4.getDayOfWeek();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(dow.equals(DayOfWeek.FRIDAY))&#123;</span><br><span class="line">			<span class="keyword">return</span> ldt4.plusDays(<span class="number">3</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(dow.equals(DayOfWeek.SATURDAY))&#123;</span><br><span class="line">			<span class="keyword">return</span> ldt4.plusDays(<span class="number">2</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">return</span> ldt4.plusDays(<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	System.out.println(ldt5);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="解析与格式化"><a href="#解析与格式化" class="headerlink" title="解析与格式化"></a>解析与格式化</h2><p>java.time.format.DateTimeFormatter 类：该类提供了三种 格式化方法：</p>
<ul>
<li>预定义的标准格式</li>
<li>语言环境相关的格式</li>
<li>自定义的格式</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test5</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//		DateTimeFormatter dtf = DateTimeFormatter.ISO_LOCAL_DATE;	</span></span><br><span class="line">	<span class="type">DateTimeFormatter</span> <span class="variable">dtf</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy年MM月dd日 HH:mm:ss E&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="type">LocalDateTime</span> <span class="variable">ldt</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">	<span class="type">String</span> <span class="variable">strDate</span> <span class="operator">=</span> ldt.format(dtf);</span><br><span class="line">	</span><br><span class="line">	System.out.println(strDate);</span><br><span class="line">	</span><br><span class="line">	<span class="type">LocalDateTime</span> <span class="variable">newLdt</span> <span class="operator">=</span> ldt.parse(strDate, dtf);</span><br><span class="line">	System.out.println(newLdt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>DateTimeFormatter时间工具类,转自</strong><a target="_blank" rel="noopener" href="https://blog.csdn.net/tanhongwei1994/article/details/86680845*https://blog.csdn.net/tanhongwei1994/article/details/86680845">DateTimeFormatter时间工具类</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.time.*;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"><span class="keyword">import</span> java.time.temporal.ChronoUnit;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xiaobu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> JDK1.8.0_171</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> on  2019/1/11 11:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> V1.0 LocalDateTime工具类</span></span><br><span class="line"><span class="comment"> * SQL -&gt; Java</span></span><br><span class="line"><span class="comment"> * date -&gt; LocalDate</span></span><br><span class="line"><span class="comment"> * time -&gt; LocalTime</span></span><br><span class="line"><span class="comment"> * timestamp -&gt; LocalDateTime</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DateTimeUtils</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">DateTimeFormatter</span> <span class="variable">TIME_FORMATTER</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;HHmmss&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">DateTimeFormatter</span> <span class="variable">YEAR_MONTH_FORMATTER</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">DateTimeFormatter</span> <span class="variable">SHORT_DATE_FORMATTER</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyMMdd&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">DateTimeFormatter</span> <span class="variable">DATE_FORMATTER</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">DateTimeFormatter</span> <span class="variable">SHORT_DATETIME_FORMATTER</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyMMddHHmmss&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">DateTimeFormatter</span> <span class="variable">DATETIME_FORMATTER</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">DateTimeFormatter</span> <span class="variable">LONG_DATETIME_FORMATTER</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd HH:mm:ss SSS&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回当前的日期</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LocalDate <span class="title function_">getCurrentLocalDate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDate.now();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回当前时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LocalTime <span class="title function_">getCurrentLocalTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalTime.now();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回当前日期时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LocalDateTime <span class="title function_">getCurrentLocalDateTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * yyyy-MM-dd</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getCurrentDateStr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDate.now().format(DATE_FORMATTER);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * yyMMdd</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getCurrentShortDateStr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDate.now().format(SHORT_DATE_FORMATTER);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getCurrentMonthStr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDate.now().format(YEAR_MONTH_FORMATTER);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getCurrentDateTimeStr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.now().format(DATETIME_FORMATTER);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getCurrentLongDateTimeStr</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.now().format(LONG_DATETIME_FORMATTER);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * yyMMddHHmmss</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getCurrentShortDateTimeStr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.now().format(SHORT_DATETIME_FORMATTER);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HHmmss</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getCurrentTimeStr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalTime.now().format(TIME_FORMATTER);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getCurrentDateStr</span><span class="params">(String pattern)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDate.now().format(DateTimeFormatter.ofPattern(pattern));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getCurrentDateTimeStr</span><span class="params">(String pattern)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(pattern));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getCurrentTimeStr</span><span class="params">(String pattern)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalTime.now().format(DateTimeFormatter.ofPattern(pattern));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LocalDate <span class="title function_">parseLocalDate</span><span class="params">(String dateStr, String pattern)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDate.parse(dateStr, DateTimeFormatter.ofPattern(pattern));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LocalDateTime <span class="title function_">parseLocalDateTime</span><span class="params">(String dateTimeStr, String pattern)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.parse(dateTimeStr, DateTimeFormatter.ofPattern(pattern));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LocalTime <span class="title function_">parseLocalTime</span><span class="params">(String timeStr, String pattern)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalTime.parse(timeStr, DateTimeFormatter.ofPattern(pattern));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">formatLocalDate</span><span class="params">(LocalDate date, String pattern)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> date.format(DateTimeFormatter.ofPattern(pattern));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">formatLocalDateTime</span><span class="params">(LocalDateTime datetime, String pattern)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> datetime.format(DateTimeFormatter.ofPattern(pattern));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">formatLocalTime</span><span class="params">(LocalTime time, String pattern)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> time.format(DateTimeFormatter.ofPattern(pattern));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LocalDate <span class="title function_">parseLocalDate</span><span class="params">(String dateStr)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDate.parse(dateStr, DATE_FORMATTER);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LocalDateTime <span class="title function_">parseLocalDateTime</span><span class="params">(String dateTimeStr)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.parse(dateTimeStr, DATETIME_FORMATTER);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LocalDateTime <span class="title function_">parseLongLocalDateTime</span><span class="params">(String longDateTimeStr)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.parse(longDateTimeStr, LONG_DATETIME_FORMATTER);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LocalTime <span class="title function_">parseLocalTime</span><span class="params">(String timeStr)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalTime.parse(timeStr, TIME_FORMATTER);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">formatLocalDate</span><span class="params">(LocalDate date)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> date.format(DATE_FORMATTER);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">formatLocalDateTime</span><span class="params">(LocalDateTime datetime)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> datetime.format(DATETIME_FORMATTER);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">formatLocalTime</span><span class="params">(LocalTime time)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> time.format(TIME_FORMATTER);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日期相隔秒</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">periodHours</span><span class="params">(LocalDateTime startDateTime,LocalDateTime endDateTime)</span>&#123;</span><br><span class="line">       <span class="keyword">return</span> Duration.between(startDateTime, endDateTime).get(ChronoUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日期相隔天数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">periodDays</span><span class="params">(LocalDate startDate, LocalDate endDate)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> startDate.until(endDate, ChronoUnit.DAYS);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日期相隔周数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">periodWeeks</span><span class="params">(LocalDate startDate, LocalDate endDate)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> startDate.until(endDate, ChronoUnit.WEEKS);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日期相隔月数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">periodMonths</span><span class="params">(LocalDate startDate, LocalDate endDate)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> startDate.until(endDate, ChronoUnit.MONTHS);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日期相隔年数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">periodYears</span><span class="params">(LocalDate startDate, LocalDate endDate)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> startDate.until(endDate, ChronoUnit.YEARS);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否当天</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isToday</span><span class="params">(LocalDate date)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getCurrentLocalDate().equals(date);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前毫秒数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">toEpochMilli</span><span class="params">(LocalDateTime dateTime)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dateTime.atZone(ZoneId.systemDefault()).toInstant().toEpochMilli();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断是否为闰年</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isLeapYear</span><span class="params">(LocalDate localDate)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> localDate.isLeapYear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="时区"><a href="#时区" class="headerlink" title="时区"></a>时区</h2><p>Java 8不仅分离了日期和时间，也把时区分离出来了。现在有一系列单独的类如ZoneId来处理特定时区，ZoneDateTime类来表示某时区下的时间。这在Java 8以前都是 GregorianCalendar类来做的。下面这个例子展示了如何把本时区的时间转换成另一个时区的时间。</p>
<p>获取所有时区id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; set = ZoneId.getAvailableZoneIds();</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ZonedDate、ZonedTime、ZonedDateTime ： 带时区的时间或日期</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test7</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">ldt</span> <span class="operator">=</span> LocalDateTime.now(ZoneId.of(<span class="string">&quot;Asia/Shanghai&quot;</span>));</span><br><span class="line">    System.out.println(ldt);</span><br><span class="line"></span><br><span class="line">    <span class="type">ZonedDateTime</span> <span class="variable">zdt</span> <span class="operator">=</span> ZonedDateTime.now(ZoneId.of(<span class="string">&quot;US/Pacific&quot;</span>));</span><br><span class="line">    System.out.println(zdt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://mrxccc.github.io/posts/c2accabf.html" data-id="cm5kxu8o3001k2wu40iimgo1b" data-title="Java8新特性-新时间与日期API" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IC/">IC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java8%E6%96%B0%E7%89%B9%E6%80%A7/">Java8新特性</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Sonarquber/">Sonarquber</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/dfinity/">dfinity</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gitlab-ci/">gitlab-ci</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring/">spring</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%8C%96%E5%88%B0%E4%BA%91%E5%8E%9F%E7%94%9F/">从服务化到云原生</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%A1%A8%E6%A0%BC%E5%A4%84%E7%90%86/">表格处理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/IC/" rel="tag">IC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/POI/" rel="tag">POI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dfinity/" rel="tag">dfinity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/easyexcel/" rel="tag">easyexcel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web3/" rel="tag">web3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">区块链</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9F%A5%E8%AF%86%E9%9D%A2/" rel="tag">知识面</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A1%A8%E6%A0%BC%E5%A4%84%E7%90%86/" rel="tag">表格处理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/IC/" style="font-size: 20px;">IC</a> <a href="/tags/POI/" style="font-size: 13.33px;">POI</a> <a href="/tags/dfinity/" style="font-size: 10px;">dfinity</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/easyexcel/" style="font-size: 10px;">easyexcel</a> <a href="/tags/web3/" style="font-size: 10px;">web3</a> <a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" style="font-size: 13.33px;">区块链</a> <a href="/tags/%E7%9F%A5%E8%AF%86%E9%9D%A2/" style="font-size: 10px;">知识面</a> <a href="/tags/%E8%A1%A8%E6%A0%BC%E5%A4%84%E7%90%86/" style="font-size: 13.33px;">表格处理</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 16.67px;">设计模式</a> <a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 10px;">转载</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">一月 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">十一月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">九月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/posts/undefined.html">solidity语言特性之数据类型</a>
          </li>
        
          <li>
            <a href="/posts/66a907b1.html">Gitlab-CICD最简单明了的入门教程</a>
          </li>
        
          <li>
            <a href="/posts/f73eb048.html">设计模式-拦截过滤器</a>
          </li>
        
          <li>
            <a href="/posts/fc25c4a4.html">IC中的账户及相关操作</a>
          </li>
        
          <li>
            <a href="/posts/f78d4d0c.html">IC上出色的基础设施（持续更新）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 mrxccc<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>